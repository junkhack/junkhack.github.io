<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">


<title>ESP-12でraspi2のシリアルコンソールをWiFi化 &#8211; JunkHack</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="/feed">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; コメントフィード" href="/comments/feed">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}</style>
	<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="export-wp-page-to-static-html-css" href="/wp-content/plugins/export-wp-page-to-static-html-pro-premium/public/css/export-wp-page-to-static-html-public.css?ver=1.0.4" type="text/css" media="all">
<link rel="stylesheet" id="wpel-style-css" href="/wp-content/plugins/wp-external-links/public/css/wpel.css?ver=2.48" type="text/css" media="all">
<link rel="stylesheet" id="wpfront-scroll-top-css" href="/wp-content/plugins/wpfront-scroll-top/css/wpfront-scroll-top.min.css?ver=2.0.4.04013" type="text/css" media="all">
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/plugins/ccrw_related/css/frontend-style.css?ver=0.1.0" type="text/css" media="all">
<link rel="stylesheet" id="hew-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="/wp-content/themes/hew-wpcom/genericons/genericons.css?ver=3.4.1" type="text/css" media="all">
<link rel="stylesheet" id="hew-style-css" href="/wp-content/themes/hew-wpcom/style.css?ver=5.7.2" type="text/css" media="all">
		<script>
			/* <![CDATA[ */
			var rcewpp = {
				"ajax_url":"/wp-admin/admin-ajax.php",
				"nonce": "c8372d57e1",
				"home_url": "/",
				"settings_icon": '/wp-content/plugins/export-wp-page-to-static-html-pro-premium/admin/images/settings.png',
				"settings_hover_icon": '/wp-content/plugins/export-wp-page-to-static-html-pro-premium/admin/images/settings_hover.png'
			};
			/* ]]\> */
		</script>
		<script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-3.5.1.min.js" id="jquery-core-js"></script>
<script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-migrate-3.3.0.min.js" id="jquery-migrate-js"></script>
<script type="text/javascript" src="/wp-content/plugins/export-wp-page-to-static-html-pro-premium/public/js/export-wp-page-to-static-html-public.js?ver=1.0.4" id="export-wp-page-to-static-html-js"></script>
<link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/posts/962">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.7.2">
<link rel="canonical" href="/962.html">
<link rel="shortlink" href="/?p=962">
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2F962.html">
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2F962.html&#038;format=xml">
<script data-ad-client="ca-pub-2711753458083215" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-161935417-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161935417-2');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-13YWDXYQE2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-13YWDXYQE2');
</script>
<body class="post-template-default single single-post postid-962 single-format-standard has-sidebar has-header-image">
<div id="page" class="hfeed site">
		<div id="widgets-wrapper" class="hide">
		
<div id="secondary" class="wrap top-widget-area" role="complementary">
		<div id="sidebar-1" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="/">
				<label>
					<span class="screen-reader-text">検索:</span>
					<input type="search" class="search-field" placeholder="検索&hellip;" value="" name="s">
				</label>
				<input type="submit" class="search-submit" value="検索">
			</form></aside>	</div>
<!-- #first .widget-area -->
	
	
	
	</div>
<!-- #secondary -->
	</div>
	
	<a class="skip-link screen-reader-text" href="#content">コンテンツへ移動</a>

	<header id="masthead" class="site-header" role="banner">
					<a class="site-logo" href="/" title="JunkHack" rel="home noopener noreferrer" data-wpel-link="internal">
				<img src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="no-grav header-image">
			</a>
		
		<div class="site-branding">
			<h1 class="site-title"><a href="/" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
			<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
		</div>

					<nav id="site-navigation" class="main-navigation" role="navigation">
				<button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button>
				<div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu">
<li id="menu-item-10711" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10711"><a href="/list.html" data-wpel-link="internal" rel="noopener noreferrer">LIST</a></li>
<li id="menu-item-10712" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10712"><a href="/status.html" data-wpel-link="internal" rel="noopener noreferrer">Status</a></li>
<li id="menu-item-10713" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10713"><a href="https://junkhack.gpl.jp/sendmail" data-wpel-link="internal" rel="noopener noreferrer">CONTACT</a></li>
</ul></div>			</nav><!-- #site-navigation -->
		
		
				<div class="toggle-wrapper">
			<a href="#" class="widgets-toggle toggle-button" title="ウィジェット">
				<span class="screen-reader-text">ウィジェット</span>
			</a>
		</div>
		
	</header><!-- #masthead -->

	<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-962" class="post-962 post type-post status-publish format-standard hentry category-esp8266 category-raspberry-pi">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="/962.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-08-16T03:34:06+09:00">2015年8月16日</time></a> </span><span class="posted-on">更新日:2015年8月16日</span> <span class="categories">  <a href="/category/esp8266" rel="category tag noopener noreferrer" data-wpel-link="internal">ESP8266</a>, <a href="/category/raspberry-pi" rel="category tag noopener noreferrer" data-wpel-link="internal">Raspberry Pi</a></span>			</div>
<!-- .entry-meta -->

							<h1 class="entry-title">ESP-12でraspi2のシリアルコンソールをWiFi化</h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>前から、興味があった透過型のUARTーWiFIブリッジ的に使う方法をあれこれ試していました。</p>
<p>結論から言えば、出来ました。</p>
<p>こんな感じで、電源はRasPi2 から取っていますので蓋の中に収められそうです。</p>
<p> <img loading="lazy" title="uart-wifi" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="uart-wifi" src="/wp-content/uploads/2015/08/uartwifi.jpg" width="640" height="480">   </p>
<p>ESP-12 に収めるプログラムは、なんとサンプルスケッチの中にありました。WiFiTelnetToSerial です。   </p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">/* 
  WiFiTelnetToSerial - Example Transparent UART to Telnet Server for esp8266

  Copyright (c) 2015 Hristo Gochkov. All rights reserved.
  This file is part of the ESP8266WiFi library for Arduino environment.
 
  This library is free software; you can redistribute it and/or
  modify it under the terms of the GNU Lesser General Public
  License as published by the Free Software Foundation; either
  version 2.1 of the License, or (at your option) any later version.

  This library is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  Lesser General Public License for more details.

  You should have received a copy of the GNU Lesser General Public
  License along with this library; if not, write to the Free Software
  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
*/
#include &lt;ESP8266WiFi.h&gt;

//how many clients should be able to telnet to this ESP8266
#define MAX_SRV_CLIENTS 1
const char* ssid = &quot;yyyyy&quot;;
const char* password = &quot;xxxxx&quot;;

WiFiServer server(23);
WiFiClient serverClients[MAX_SRV_CLIENTS];

void setup() {
  Serial1.begin(115200);
  WiFi.begin(ssid, password);
  Serial1.print(&quot;\nConnecting to &quot;); Serial1.println(ssid);
  uint8_t i = 0;
  while (WiFi.status() != WL_CONNECTED &amp;&amp; i++ &lt; 20) delay(500);
  if(i == 21){
    Serial1.print(&quot;Could not connect to&quot;); Serial1.println(ssid);
    while(1) delay(500);
  }
  //start UART and the server
  Serial.begin(115200);
  server.begin();
  server.setNoDelay(true);
  
  Serial1.print(&quot;Ready! Use 'telnet &quot;);
  Serial1.print(WiFi.localIP());
  Serial1.println(&quot; 23' to connect&quot;);
}

void loop() {
  uint8_t i;
  //check if there are any new clients
  if (server.hasClient()){
    for(i = 0; i &lt; MAX_SRV_CLIENTS; i++){
      //find free/disconnected spot
      if (!serverClients[i] || !serverClients[i].connected()){
        if(serverClients[i]) serverClients[i].stop();
        serverClients[i] = server.available();
        Serial1.print(&quot;New client: &quot;); Serial1.print(i);
        continue;
      }
    }
    //no free/disconnected spot so reject
    WiFiClient serverClient = server.available();
    serverClient.stop();
  }
  //check clients for data
  for(i = 0; i &lt; MAX_SRV_CLIENTS; i++){
    if (serverClients[i] &amp;&amp; serverClients[i].connected()){
      if(serverClients[i].available()){
        //get data from the telnet client and push it to the UART
        while(serverClients[i].available()) Serial.write(serverClients[i].read());
      }
    }
  }
  //check UART for data
  if(Serial.available()){
    size_t len = Serial.available();
    uint8_t sbuf[len];
    Serial.readBytes(sbuf, len);
    //push UART data to all connected telnet clients
    for(i = 0; i &lt; MAX_SRV_CLIENTS; i++){
      if (serverClients[i] &amp;&amp; serverClients[i].connected()){
        serverClients[i].write(sbuf, len);
        delay(1);
      }
    }
  }
}</pre>
<p>ArduinoIDE へ、ESP8266 Arduino Core の最新（ver. 1.6.5-1044-g170995a, built on Aug 10, 2015）を収めました。</p>
<p>SDK1.3 が収まったものは、以下のStaging versionから入れました。</p>
<blockquote>
<p><a title="https://github.com/esp8266/Arduino" href="https://github.com/esp8266/Arduino" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">https://github.com/esp8266/Arduino<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p>Staging version<br>
    <br>Boards manager link: http://arduino.esp8266.com/staging/package_esp8266com_index.json</p>
</blockquote>
<p>リファレンスも出来て、だんだんと充実してきたようです。</p>
<p><a href="http://arduino.esp8266.com/versions/1.6.5-1044-g170995a/doc/reference.html" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" title="esp-12_pin" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="esp-12_pin" src="/wp-content/uploads/2015/08/esp12_pin.png" width="467" height="280"></a> </p>
<p>スケッチは、スケッチの例＞ESP8266Wifi ＞WiFiTelnetToSerial のところから辿っていきます。<br>
  <br>ボード設定は、以下のようにしました。</p>
<blockquote>
<p>Borad : Generic ESP8266 Module<br>
    <br>Flash mode : QIO</p>
<p>Flash frequency : 40Mhz</p>
<p>CPU frequency : 80Mhz</p>
<p>Flash size : 4M (3M SPIFFS)</p>
<p>Upload speed : 115200</p>
</blockquote>
<p>配線は、RasPi2 の TX RX を ESP12 のRX TX へつなぎ、3.3V のVCC と GND をつなぐ感じ。RasPiには、シリアルコンソールの設定がしてある状態で電源ON</p>
<p>5,6秒ほどで、ESP12 がアクセスポイントへ接続するので、ESP12 がIP を何をとっているか、DHCPの払い出しIP をを見て、以下のコマンドで接続。socat は brew で入れました。</p>
<blockquote>
<p>
    <br>$ socat STDIN tcp-connect:192.168.1.36:23</p>
</blockquote>
<p>これで、シリアル接続のものは、WiFi 化できそうです。接続するツールは工夫する必要がありそうです。たとえば、osx だと、MultiCom というツールがあり、接続をパイプできるので便利です。</p>
<p><img loading="lazy" title="MultiCom_と_WiFiTelnetToSerial___Arduino_1_6_5_Hourly_Build_2015_06_12_03_13" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="MultiCom_と_WiFiTelnetToSerial___Arduino_1_6_5_Hourly_Build_2015_06_12_03_13" src="/wp-content/uploads/2015/08/multicom__wifitelnettoserial___arduino_1_6_5_hourly_build_2015_06_12_03_13.png" width="338" height="158"> </p>
<p><img loading="lazy" title="ishizaka_—_telnet_—_ttys003_—_70×21_と_ishizaka_—_telnet_—_ttys004_—_70×21_と_Change_log" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="ishizaka_—_telnet_—_ttys003_—_70×21_と_ishizaka_—_telnet_—_ttys004_—_70×21_と_Change_log" src="/wp-content/uploads/2015/08/ishizaka__telnet__ttys003__7021__ishizaka__telnet__ttys004__7021__change_log.png" width="517" height="652">  <br>まだ、あんまり使い方はわかっていないんですが、IPとポート指定で ESP12 のWiFi へ接続し、それをローカルのプロキシーのようなものに接続し、複数接続できるようです。Windows のcom0com のようなのが欲しかったのですが、osx では見つけられませんでした。</p>
<p>あと、リモートからだと、コンソールのサイズも大きいほうが使いやすいので、getty の設定を以下のように変更。</p>
<blockquote>
<p> —- /etc/default/console-setup</p>
<p>::</p>
<p>SCREEN_WIDTH=150<br>
    <br>SCREEN_HEIGHT=60</p>
</blockquote>
<p>あと、環境変数へ設定。</p>
<blockquote>
<p>—- .bashrc</p>
<p>::</p>
<p>export LINES=150<br>
    <br>export COLUMNS=60</p>
</blockquote>
<p>とりあえず、こんな感じで使えるようになりました。tab補完や、そういうのはどうやるんでしょうね？ま、おいおい。</p>
<p>USB to シリアル がなくてもワイヤレスで、シリアルが使えるというのはなんとも、慣れないですが、今後活用のアイデアも出てくるかもしれません。ESP12 に下駄をはかせず、基盤にうまく実装すれば蓋の中に納まりそうですし。RasPiのベアメタル開発に手を出したときには便利かもしれませんね。</p>
<p>リチウム電池とESPを組み合わせて、単品のシリアルWiFi機器とすれば、何か応用できるかもです。</p>
					</div>
<!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div>
<!-- .entry-wrapper -->
</article><!-- #post-## -->

			
	<nav class="navigation post-navigation" role="navigation" aria-label="投稿">
		<h2 class="screen-reader-text">投稿ナビゲーション</h2>
		<div class="nav-links">
<div class="nav-previous"><a href="/953.html" rel="prev noopener noreferrer" data-wpel-link="internal">ESP-12のファームウェアをv1.3.0 に</a></div>
<div class="nav-next"><a href="/966.html" rel="next noopener noreferrer" data-wpel-link="internal">osx のシリアルポートのユーティリティーあれこれ</a></div>
</div>
	</nav>
			
		
		</main><!-- #main -->
	</div>
<!-- #primary -->


	</div>
<!-- #content -->

	<footer id="colophon" class="site-footer wrap" role="contentinfo">
		<div class="site-info">
			Copyleft - all rights reversed.
			<span class="sep"> | </span>
			JunkHack 2011 - 2021
			<span class="sep"> | </span>
			<a href="https://junkhack.gpl.jp/about-junkhack/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">運営者情報<span class="gf"><span class="wpel-icon wpel-image wpel-icon-1"></span></span></a><span class="sep"> | </span>
			<a href="https://junkhack.gpl.jp/sendmail/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">お問い合わせ<span class="gf"><span class="wpel-icon wpel-image wpel-icon-1"></span></span></a><span class="sep"> | </span>
			<a href="https://junkhack.gpl.jp/privacy/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">プライバシーポリシー<span class="gf"><span class="wpel-icon wpel-image wpel-icon-1"></span></span></a>
		</div>
<!-- .site-info -->

	</footer><!-- #colophon -->
</div>
<!-- #page -->

        <div id="wpfront-scroll-top-container">
            <img src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt="">        </div>
                <script type="text/javascript">
            function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();
        </script>
        <script type="text/javascript" src="/wp-content/plugins/wpfront-scroll-top/js/wpfront-scroll-top.min.js?ver=2.0.4.04013" id="wpfront-scroll-top-js"></script>
<script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/hew.js?ver=20140909" id="hew-scripts-js"></script>
<script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/navigation.js?ver=20120206" id="hew-navigation-js"></script>
<script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/skip-link-focus-fix.js?ver=20130115" id="hew-skip-link-focus-fix-js"></script>
<script type="text/javascript" src="/wp-includes/js/wp-embed.min.js?ver=5.7.2" id="wp-embed-js"></script>

</body>
</html>