<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://hack.gpl.jp/xmlrpc.php">

<title>BackBoost &#8211; JunkHack</title>
<style type="text/css">.wpfts-result-item .wpfts-smart-excerpt {}.wpfts-result-item .wpfts-not-found {color:#808080;font-size:0.9em;}.wpfts-result-item .wpfts-score {color:#006621;font-size:0.9em;}.wpfts-shift {margin-left:40px;}.wpfts-result-item .wpfts-download-link {color:#006621;font-size:0.9em;}.wpfts-result-item .wpfts-file-size {color:#006621;font-size:0.9em;}</style><meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//hack.gpl.jp' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="https://hack.gpl.jp/feed/" />
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; コメントフィード" href="https://hack.gpl.jp/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; BackBoost カテゴリーのフィード" href="https://hack.gpl.jp/category/backboost/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/hack.gpl.jp\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' href='./../css/dist-block-library-style.min.css'>
<link rel='stylesheet' href='./../css/export-wp-page-to-static-html-pro-premium-public-css-export-wp-page-to-static-html-public.css'>
<link rel='stylesheet' href='./../css/fulltext-search-style-wpfts_autocomplete.css'>
<link rel='stylesheet' href='./../css/wp-external-links-public-css-wpel.css'>
<link rel='stylesheet' href='./../css/wpfront-scroll-top-css-wpfront-scroll-top.min.css'>
<link rel='stylesheet' href='./../css/ccrw_related-css-frontend-style.css'>
<link rel='stylesheet' id='hew-fonts-css'  href='https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin' type='text/css' media='all' />
<link rel='stylesheet' href='./../css/hew-wpcom-genericons-genericons.css'>
<link rel='stylesheet' href='./../css/hew-wpcom-style.css'>
		<script>
			/* <![CDATA[ */
			var rcewpp = {
				"ajax_url":"https://hack.gpl.jp/wp-admin/admin-ajax.php",
				"nonce": "4eef5ded05",
				"home_url": "https://hack.gpl.jp/",
				"settings_icon": 'https://hack.gpl.jp/wp-content/plugins/export-wp-page-to-static-html-pro-premium/admin/images/settings.png',
				"settings_hover_icon": 'https://hack.gpl.jp/wp-content/plugins/export-wp-page-to-static-html-pro-premium/admin/images/settings_hover.png'
			};
			/* ]]\> */
		</script>
		<script type='text/javascript' src='./../js/jquery-3.5.1.min.js' id='jquery-core-js'></script>
<script type='text/javascript' src='./../js/jquery-migrate-3.3.0.min.js' id='jquery-migrate-js'></script>
<script type='text/javascript' src='./../js/export-wp-page-to-static-html-public.js' id='export-wp-page-to-static-html-js'></script>
<script type='text/javascript' src='./../js/wpfts_frontend.js' id='wpfts_frontend-js'></script>
<link rel="https://api.w.org/" href="https://hack.gpl.jp/wp-json/" /><link rel="alternate" type="application/json" href="https://hack.gpl.jp/wp-json/wp/v2/categories/10" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://hack.gpl.jp/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://hack.gpl.jp/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7.2" />
<script type="text/javascript">
		document.wpfts_ajaxurl = "https://hack.gpl.jp/wp-admin/admin-ajax.php";
	</script>				<style id="uagb-style-conditional-extension">@media (min-width: 1025px){body .uag-hide-desktop.uagb-google-map__wrap,body .uag-hide-desktop{display:none}}@media (min-width: 768px) and (max-width: 1024px){body .uag-hide-tab.uagb-google-map__wrap,body .uag-hide-tab{display:none}}@media (max-width: 767px){body .uag-hide-mob.uagb-google-map__wrap,body .uag-hide-mob{display:none}}</style>
			<script data-ad-client="ca-pub-2711753458083215" async src="./../js/adsbygoogle.js"></script>
</head>

<script async src="./../js/8220.js"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-13YWDXYQE2');
</script>
<body class="archive category category-backboost category-10 has-sidebar">
<div id="page" class="hfeed site">
		<div id="widgets-wrapper" class="hide">
		
<div id="secondary" class="wrap top-widget-area" role="complementary">
	
	
	
		<div id="sidebar-4" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://hack.gpl.jp/">
				<label>
					<span class="screen-reader-text">検索:</span>
					<input type="search" class="search-field" placeholder="検索&hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="検索" />
			</form></aside>	</div><!-- #four .widget-area -->
	</div><!-- #secondary -->
	</div>
	
	<a class="skip-link screen-reader-text" href="">コンテンツへ移動</a>

	<header id="masthead" class="site-header" role="banner">
		
		<div class="site-branding">
			<h1 class="site-title"><a href="./../index.html" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
			<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
		</div>

					<nav id="site-navigation" class="main-navigation" role="navigation">
				<button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button>
				<div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu"><li id="menu-item-9578" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-9578"><a href="./../index.html" data-wpel-link="internal" rel="noopener noreferrer">List</a></li>
<li id="menu-item-9594" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-9594"><a href="./../status.html" data-wpel-link="internal" rel="noopener noreferrer">Status</a></li>
</ul></div>			</nav><!-- #site-navigation -->
		
		
				<div class="toggle-wrapper">
			<a href="" class="widgets-toggle toggle-button" title="ウィジェット">
				<span class="screen-reader-text">ウィジェット</span>
			</a>
		</div>
		
	</header><!-- #masthead -->

	<div id="content" class="site-content">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">カテゴリー: <span>BackBoost</span></h1>			</header><!-- .page-header -->

						
				
<article id="post-1295" class="post-1295 post type-post status-publish format-standard hentry category-aliexpress category-backboost category-espeink category-parts category-pcb">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="./../1295.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-09-29T06:59:26+09:00">2015年9月29日</time></a> </span><span class="posted-on">更新日:2015年9月29日</span> <span class="categories">  <a href="./../category/aliexpress.html" rel="category tag noopener noreferrer" data-wpel-link="internal">Aliexpress</a>, <a href="./../category/backboost.html" rel="category tag noopener noreferrer" data-wpel-link="internal">BackBoost</a>, <a href="./../category/espeink.html" rel="category tag noopener noreferrer" data-wpel-link="internal">espeink</a>, <a href="./../category/parts.html" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a>, <a href="./../category/pcb.html" rel="category tag noopener noreferrer" data-wpel-link="internal">PCB</a></span>			</div><!-- .entry-meta -->

							<h1 class="entry-title"><a href="./../ /1295.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">smd 0603 の抵抗とコンデンサをぽちった</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>とりあえず、電子工作のディープな世界に足を突っ込む意気込みとして、SMD の 0603 タイプの抵抗とコンデンサをぽちりました。両方あわせて、9750個もあるのでまぁ死ぬまで持ちそうです。購入店は、いつもお世話になっているパーツ屋さん。ここは好評価で、来るのも速いので。</p>
<p><img loading="lazy" title="HTB1S.SQIpXXXXcXXFXXq6xXFXXXx" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="HTB1S.SQIpXXXXcXXFXXq6xXFXXXx" src="./../images/htb1s-sqipxxxxcxxfxxq6xxfxxxx.jpg" width="640" height="426" /></p>
<p>こんな感じで、本になっているんですね。</p>
<p><img loading="lazy" title="HTB1VyOWIpXXXXXSXFXXq6xXFXXXz" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="HTB1VyOWIpXXXXXSXFXXq6xXFXXXz" src="./../images/htb1vyowipxxxxxsxfxxq6xxfxxxz.jpg" width="640" height="426" /></p>
</p>
<p>そして、まず作るのは、バックブーストの1セル用の電圧回路を作ってみようと思います。</p>
<p>TPS63000 と、TDK のコイルもあわせてゲット。</p>
<p><a title="http://www.tdk.de/company/inductors_coils/e531_vlf4012a.pdf" href="http://www.tdk.de/company/inductors_coils/e531_vlf4012a.pdf" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://www.tdk.de/company/inductors_coils/e531_vlf4012a.pdf<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p><a title="https://strawberry-linux.com/pub/tps63000.pdf" href="https://strawberry-linux.com/pub/tps63000.pdf" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">https://strawberry-linux.com/pub/tps63000.pdf<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p>プリント基板を作成する一歩目のお題としてはライトなので、これをESP8266 向けに設計してみようかと思います。ESP13 もあわせてゲット。大きさは、telec のWROOM02 と同じなので、こっちをこれからメインに使用していこうかと。</p>
					</div><!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div><!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-1298" class="post-1298 post type-post status-publish format-standard hentry category-aliexpress category-backboost category-esp8266 category-parts category-pcb">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="./../1298.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-10-01T06:37:08+09:00">2015年10月1日</time></a> </span><span class="posted-on">更新日:2015年10月1日</span> <span class="categories">  <a href="./../category/aliexpress.html" rel="category tag noopener noreferrer" data-wpel-link="internal">Aliexpress</a>, <a href="./../category/backboost.html" rel="category tag noopener noreferrer" data-wpel-link="internal">BackBoost</a>, <a href="./../category/esp8266.html" rel="category tag noopener noreferrer" data-wpel-link="internal">ESP8266</a>, <a href="./../category/parts.html" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a>, <a href="./../category/pcb.html" rel="category tag noopener noreferrer" data-wpel-link="internal">PCB</a></span>			</div><!-- .entry-meta -->

							<h1 class="entry-title"><a href="./../ /1298.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">ESP8266 でADC 増設するには？</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>ESPシリーズは、全機種ADC が1ポートなので、アナログ値を読むには何かしら工夫しないといけないのですが、その方法を模索したいと思います。新しい課題です。</p>
<p>&#160;</p>
<p>調査第一段階では、以下のものがあるようです。</p>
<blockquote>
<p>ESP8266 Analog Input Expander Library for MCP3021 A/D Conveters</p>
<p><a title="https://github.com/AllAboutEE/ESP8266-MCP3021-Library" href="https://github.com/AllAboutEE/ESP8266-MCP3021-Library" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">https://github.com/AllAboutEE/ESP8266-MCP3021-Library<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<p>これは、tindie で作っているヒトがいるようです。</p>
<blockquote>
<p>ESP8266 Analog Inputs Expander (Version 2)</p>
<p><a title="https://www.tindie.com/products/AllAboutEE/esp8266-analog-inputs-expander/" href="https://www.tindie.com/products/AllAboutEE/esp8266-analog-inputs-expander/" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">https://www.tindie.com/products/AllAboutEE/esp8266-analog-inputs-expander/<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<p>初期リリース版は、４つの<a href="http://ww1.microchip.com/downloads/en/DeviceDoc/21805B.pdf" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">Microchip MCP3021<span class="wpel-icon wpel-image wpel-icon-1"></span></a>を使っているようですが、Version2では、１ICとなっているようです。このIC は4チャンネルのやつだと思うのですが、型番がよくわかりません。<a href="http://ww1.microchip.com/downloads/en/DeviceDoc/21697F.pdf" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">MCP3304<span class="wpel-icon wpel-image wpel-icon-1"></span></a> か、MCP3008のTSSOP パッケージかな？ちょっとお尋ね申すことに。</p>
<p>&#160;</p>
<p>とりあえず、回路は簡単そうなので部品を入手して模索してみたいと思います。</p>
					</div><!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div><!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-1308" class="post-1308 post type-post status-publish format-standard hentry category-aliexpress category-backboost category-esp8266 category-parts category-pcb">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="./../1308.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-10-04T14:21:35+09:00">2015年10月4日</time></a> </span><span class="posted-on">更新日:2015年10月4日</span> <span class="categories">  <a href="./../category/aliexpress.html" rel="category tag noopener noreferrer" data-wpel-link="internal">Aliexpress</a>, <a href="./../category/backboost.html" rel="category tag noopener noreferrer" data-wpel-link="internal">BackBoost</a>, <a href="./../category/esp8266.html" rel="category tag noopener noreferrer" data-wpel-link="internal">ESP8266</a>, <a href="./../category/parts.html" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a>, <a href="./../category/pcb.html" rel="category tag noopener noreferrer" data-wpel-link="internal">PCB</a></span>			</div><!-- .entry-meta -->

							<h1 class="entry-title"><a href="./../ /1308.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">ESP13 と BackBoost のPCBを作成中</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>Eagle の勉強と、PCB をプリントに出すため、まずはお手ごろな素材を元に勉強中。</p>
<p>&#160;</p>
<p>コンセプト</p>
<p>・Lion の1セルに、充電ができて、過充電、過放電保護がある</p>
<p>・充電は、マイクロUSB からできる</p>
<p>・1セルから3.3v を効率よく、安定して作るため、backboost 回路を入れる</p>
<p>・自分が持っている、UART のシリアル変換を直接挿せるようにする</p>
<p>・ケースに入れる都合上、幅を2cm ｘ 6.5cm 未満とする</p>
<p>・UART の PIN は自動的にリセットがかかるよう、DTR からの信号を処理する回路を埋め込む</p>
<p>・バッテリーや、3.3V 出力など後に計測したいので、PINを出しておく</p>
<p>・DeepSleep は必ず使うので、配線しておく</p>
<p>・ブレッドボードに挿せる様、PIN を出しておく</p>
<p>・なるべく安くする</p>
<p>・レゴブロック風のものをジョイントすると機能が拡張できるようにしたい。</p>
<p>&#160;</p>
<p>といういうな、お題を掲げて作っています。</p>
<p>まだ、途中ですが、以下のようなものができてきました。</p>
<p><img loading="lazy" title="１" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="１" src="./../images/50cd513eb03b.png" width="632" height="480" /> </p>
<p>安くあげるため、USB と充電回路（保護付き）は既成のモジュールを使うことに、90円くらいのものです。</p>
<p>この基板をノギスや、スキャナで取ってeagle のライブラリを作成。ここが面倒でした。また、ESP12Eと、ESP13（WROOM-02）と大きさを比べると、ESP13の方が小さく、組み込みやすそうです。</p>
<p><img loading="lazy" title="２" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="２" src="./../images/46fc6a9bb869.png" width="640" height="276" /> </p>
<p>今回の目玉である、バックブースト回路は表に載せました。ブレッドボードに指せば裏側に回る予定。真ん中のパッド部分はスルーホールを横に作って、裏側の胴箔に熱伝統させる予定です。</p>
<p><img loading="lazy" title="３" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="３" src="./../images/5564089f0a54.png" width="640" height="227" /> </p>
<p>裏面に部品が回せるのを知ったので、（Mirrorすれば良いだけですが、、、）上記のような配置にしました。まだ配線は仮なので、これから変わります。</p>
<p><img loading="lazy" title="４" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="４" src="./../images/c67b20796fcb.png" width="640" height="240" /> </p>
<p>左には、UARTのPINを直接させるようメスピンヘッダーをつけます。順番は逆配列にしないとブレッドボードに挿した時LEDとか見えませんので、後に変更予定です。</p>
<p>&#160;</p>
<p><img loading="lazy" title="５" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="５" src="./../images/9e55fc09f89e.png" width="640" height="384" /> </p>
<p>回路図は、離れたところにある配線をどうやるのかわからず、あれこれググりました。これはラベルでやるようですが、いまいち良くわかっていません。とりあず、つなぎたいところに、配線を伸ばしNAMEをつけて、ラベルみたいなのは、シンボルがあったので、それを使っています。supply2.lbr というのにありました。たぶんもっといいやり方があるのでしょうが、良くわかりません。機能は満たしているので、今はこれでよしとします。</p>
<p>&#160;</p>
<p>先人たちの回路図を見ると、機能ごとに分離して、見やすくする工夫をしているようです。なので上記のような感じにしてみました。その後、あれこれと思案し、以下のようになっています。まだ途中。</p>
<p>&#160;<img loading="lazy" title="６" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="６" src="./../images/ec553b09028c.png" width="640" height="234" /> </p>
<p>ブレッドボードに挿すPINは最低限のものにしたけれども、案外空きスペースがなくなって来ているので、複雑な回路だと2階建てにする感じになりそう。</p>
<p>&#160;</p>
<p>▼まとめ</p>
<p>・回路図は見やすくするため、機能ごとにわける。</p>
<p>・離れたところを配線するため、NAMEを使い、ラベルをつける</p>
<p>・ラベルは回路図だけに出るライブラリ（supply2.lbr ）があるのでそれを使う</p>
<p>・裏面に部品を配置するには、Mirror を使う。</p>
<p>・実際の部品で仕様がわからないものは、スキャニングして大きさを算出。ノギスで実物を計測。</p>
<p>・独自ライブラリを作るには、３ステップ。</p>
<p>New &gt; Library</p>
<p>Package 作成（左から5番目のアイコン）で、PCB基板に実際に付く図形を書く</p>
<p>Simbol 作成で、回路図上で見える図とPINを書く</p>
<p>Device 作成し、上記を対応づけ。Connect でPIN対応づけできる</p>
<p>・部品の配置の際、ルーラをドキュメントレイヤーに置いておくと便利（Metric ruler のLIB）</p>
<p>&#160;</p>
<p>▼不明なこと</p>
<p>・離れたとこにある配線のやりかた。見やすいラベルを同時付け、対応づけるには？</p>
<p>・ESP13のUARTでリセットを自動的に行う回路。いろいろあるようです。現在3種類のやり方を模索。モノがまだ来ていないので着たら検討。</p>
<p>・ESP13 と ESP12のピンの対応づけ表がほしい。 EN は CHPD で、TOUTは、ADCに対応していると考えればよい？</p>
<p>・ESP13はGNDが２つ増え、合計３つ。なので、PIN数がESP13の18PINに対し、ESP12は、１６PINということなのか？</p>
<p>&#160;</p>
<p>▼調査すること</p>
<p>・幅、２ｃｍｘ長さ５ｃｍ、暑さ５ｍｍくらいのお値打ちLIONを探す。</p>
<p>・どっかの記事で、ADCはダイオードをかませば、GPIOのピン数分読めるというような英文記事を見たが、あれは本当か？</p>
					</div><!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div><!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-1314" class="post-1314 post type-post status-publish format-standard hentry category-backboost category-esp8266 category-parts category-pcb">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="./../1314.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-10-07T20:44:53+09:00">2015年10月7日</time></a> </span><span class="posted-on">更新日:2015年10月7日</span> <span class="categories">  <a href="./../category/backboost.html" rel="category tag noopener noreferrer" data-wpel-link="internal">BackBoost</a>, <a href="./../category/esp8266.html" rel="category tag noopener noreferrer" data-wpel-link="internal">ESP8266</a>, <a href="./../category/parts.html" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a>, <a href="./../category/pcb.html" rel="category tag noopener noreferrer" data-wpel-link="internal">PCB</a></span>			</div><!-- .entry-meta -->

							<h1 class="entry-title"><a href="./../ /1314.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">ESP8266 でADC 増設その２</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>前回、ADC のアナログ入力を増設する方法として以下を調査していました。</p>
<blockquote>
<p><a href="./../2015/10/01/esp8266-%E3%81%A7adc-%E5%A2%97%E8%A8%AD%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%EF%BC%9F.html" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">ESP8266 でADC 増設するには？</a></p>
</blockquote>
<p>作者に聞いてみたところ、Version２のICには、MAX11609EEE+ を使っているとの事。16ピンQSOP で、DigiKey で336円くらいのものです。</p>
<blockquote>
<p><a href="http://www.digikey.jp/product-detail/ja/MAX11609EEE%2B/MAX11609EEE%2B-ND/2062008" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">MAX11609EEE+<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p><a href="http://datasheets.maximintegrated.com/en/ds/MAX11606-MAX11611.pdf" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">datasheet<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<p>データシートを見てみると、これは8チャンネルあるようです。通信は、I２Cでいけるようです。</p>
<p> <img loading="lazy" title="MAX11609EEE" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="MAX11609EEE" src="./../images/max11609eee.png" width="582" height="768" />   </p>
<p>とりあえず、8チャンネルもいらないので、4チャンネルのMAX11607 というのを試しに使ってみようかと思っています。</p>
<p>Aliexpress で価格を調査すると、<a href="http://www.aliexpress.com/item/MAX11607EUA-TSSOP-8-3MM-a-d-converter-IC-MAX11607EUA-MAX11607/32334927362.html" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">４ch<span class="wpel-icon wpel-image wpel-icon-1"></span></a> も <a href="http://www.aliexpress.com/item/Original-MAX11609EEE-IC-ADC-SERIAL-10BIT-8CH-16-QSOP-IC/32460839234.html" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">8ch<span class="wpel-icon wpel-image wpel-icon-1"></span></a> も値段がほとんど変わらないようです。1個400円ちょい。</p>
<p>&#160;</p>
<blockquote>
<p>他にも、<a href="http://www.digikey.jp/product-search/ja?FV=fff40027%2Cfff80183%2C3cc0021%2Ca6c0004%2Ca6c0006&amp;mnonly=0&amp;newproducts=0&amp;ColumnSort=1000011&amp;page=1&amp;stock=1&amp;pbfree=0&amp;rohs=0&amp;quantity=&amp;ptm=0&amp;fid=0&amp;pageSize=25" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">I2C で ADC はいろいろあるようで<span class="wpel-icon wpel-image wpel-icon-1"></span></a>、たとえば、TIの4チャンネルなんかの <a href="http://www.ti.com/lit/ds/symlink/ads7924.pdf" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">ADS7924<span class="wpel-icon wpel-image wpel-icon-1"></span></a>IRTER は供給量も多いようです。</p>
</blockquote>
<p>&#160;</p>
<p>標準で付いている、ADC も工夫すればGPIO 分のアナログリードができるようなのでそれを試してみてから考えたいと思います。</p>
<p>ダイオードをつけて、計測前にGPIO x ピンをHigh にしてADC 値を読むという原理です。 Lua のサンプルコードでそんなロジックが書いてありました。なるほどーですね。</p>
<p>&#160;</p>
<p>で、手持ちのダイオードがなぜか見つからず、ジャンクのマザーボードからチップダイオードを採取してユニバーサル基板につけたところまで今、作業が進んでいます。</p>
					</div><!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div><!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-1321" class="post-1321 post type-post status-publish format-standard hentry category-backboost category-esp8266 category-parts category-pcb">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="./../1321.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-10-09T22:14:11+09:00">2015年10月9日</time></a> </span><span class="posted-on">更新日:2015年10月9日</span> <span class="categories">  <a href="./../category/backboost.html" rel="category tag noopener noreferrer" data-wpel-link="internal">BackBoost</a>, <a href="./../category/esp8266.html" rel="category tag noopener noreferrer" data-wpel-link="internal">ESP8266</a>, <a href="./../category/parts.html" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a>, <a href="./../category/pcb.html" rel="category tag noopener noreferrer" data-wpel-link="internal">PCB</a></span>			</div><!-- .entry-meta -->

							<h1 class="entry-title"><a href="./../ /1321.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">ESP8266 でADC 増設その3</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>外部のADCを利用せず、スイッチをつけて内部のADCを利用するというアプローチが以下にありました。</p>
<blockquote>
<p>TINKERING WITH TECHNOLOGY</p>
<p><a href="http://tinker.yeoman.com.au/2015/05/26/when-you-need-multiple-analog-inputs-for-your-esp8266-application/" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">WHEN YOU NEED MULTIPLE ANALOG INPUTS FOR YOUR ESP8266 APPLICATION<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<p>なるほどーです。<a href="https://www.fairchildsemi.co.jp/products/analog-mixed-signal/switches/analog-switches/FSA3157.html" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">FSA3157<span class="wpel-icon wpel-image wpel-icon-1"></span></a> というスイッチをつけて、GPIO ピンからデジタルでHigh Low させることによりスイッチを動作させるものです。なんか日本語変ですが。上記ブログと、データシート見たほうがわかりやすいです。</p>
<blockquote>
<p>FarChild Semiconductor FSA3157      <br /><a href="http://www.farnell.com/datasheets/690558.pdf" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">datasheet<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<p>&#160;<img loading="lazy" title="www_farnell_com_datasheets_690558_pdf" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="www_farnell_com_datasheets_690558_pdf" src="./../images/www_farnell_com_datasheets_690558_pdf.png" width="727" height="768" /> </p>
<p>&#160;</p>
<p>これで、ADCのソースを２つから選べるようになるということですね。</p>
<p>3つのソースを２つのGPIOで制御する場合は、以下のICを。</p>
<blockquote>
<p>FSA3357</p>
<p><a href="https://www.fairchildsemi.com/datasheets/FS/FSA3357.pdf" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">datasheet<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<p>価格的には、どちらも安いので候補ですね。ハードの世界はいろいろなICがあって、面白いですね。</p>
<p>配置した感じでは、大きさがほとんど変わらないので、8pin の 3チャンネル切り替えられる FSA3357 を導入することに。前回検討していた、ダイオードを挟む方法は、正確に抵抗値を読みたいので、適しませんでした。</p>
<p><img loading="lazy" title="aaa" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="aaa" src="./../images/aaa.png" width="640" height="312" /> </p>
<p><a href="http://www.aliexpress.com/item/Free-Shipping-Integrated-Circuits-Types-FSA3357K8X-IC-SWITCH-SP3T-US8-3357-FSA3357-10pcs/32384506374.html" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">AliExpress<span class="wpel-icon wpel-image wpel-icon-1"></span></a> にて、10個1083円なり。1個110円くらいです。</p>
<p>これを組み込んで、電源電圧他、２つのアナログ値を取れるようにして、１つはCDSの照度に使い、あと１つはPINを出しておく形にしておきます。</p>
<p><img loading="lazy" title="xxx" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="xxx" src="./../images/xxx.png" width="634" height="480" /> </p>
<p>&#160;</p>
</p>
<p>抵抗分圧して、3.3v をいったん、0.5VにしてADC で値を読ませた後に、元の値に戻しています。wifi eink のコードにあったやつです。まだ、ものがないのでS1,S2 の切り替えコードは書いていませんが、抵抗分圧して、内臓のADC で1V 以上の抵抗を読めるようにテストしてみました。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">/*
 ADC Read Sample
 Arduino IDE 1.6.5 Hourly Build 2015/06/12 03:13
 esp8266 by ESP8266 Community version 1.6.5 Hourly Build 2015/06/12
 JunkHack 2015.10.10

 --- ex Serial output.
 Blink Count: 40
 ADC mv: 3319
 ADC mv: 3313
 Blink Count: 41
 ADC mv: 3319
 ADC mv: 3313
 ::

 */
 
#include &lt;ESP8266WiFi.h&gt;

int ledState = LOW;     

unsigned long previousMillis = 0;
const long interval = 1000;

void setup() {
  pinMode(BUILTIN_LED, OUTPUT);
  Serial.begin(115200);
  delay(10);
}

int value = 0;
int count = 0;
int adc = 0;
int batteryMeasMv = -1;

void loop()
{
  delay(interval);
  ++value;
  
  unsigned long currentMillis = millis();
  if(currentMillis - previousMillis &gt;= interval) {
    previousMillis = currentMillis;   
    if (ledState == LOW){
      ledState = HIGH;  // Note that this switches the LED *off*
    } else {
      ledState = LOW;   // Note that this switches the LED *on*
      digitalWrite(BUILTIN_LED, ledState);
      delay(1);
      count += 1;
      Serial.print(&quot;Blink Count: &quot;);
      Serial.println(count);
    }
  }
  //Battery voltage is divided by an 5.6K/1K resistor divider.
  //ADC: 1024 = 1V
  adc = analogRead(A0);
  batteryMeasMv=(adc*10020*6.6)/10000;
  //                 ^^^^^To correct an error in the resistance value

  Serial.print(&quot;ADC mv: &quot;);
  
  delay(1);
  Serial.println(batteryMeasMv);

}</pre>
<p>テスターで実測値に近くなるよう係数を補正しています。</p>
<p>自分自身の電圧をグラフに投げて、長期DeepSpeel の電圧降下具合を記録できそうです。</p>
<p>&#160;</p>
<p>手抜きですが、以下のようなコードになる感じですかね。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">/*
 ADC Read Sample.
 Fairchild Semiconductor FSA3357 adc Select.
 Arduino IDE 1.6.5 Hourly Build 2015/06/12 03:13
 esp8266 by ESP8266 Community version 1.6.5 Hourly Build 2015/06/12
 JunkHack 2015.10.10

 --- ex Serial output.
  Blink Count: 1
  &gt;adc1(B0)
  ADC mv: 3280
  &gt;adc2(B1)
  ADC mv: 3273
  &gt;adc3(B2)
  ADC mv: 3293
  &gt;adc off
 ::

 */

#include &lt;ESP8266WiFi.h&gt;

int ledState = LOW;     
unsigned long previousMillis = 0;
const long interval = 1000; //1sec

/******************************************************
 * Fairchild Semiconductor FSA3357 adc Select.
 * 0 = No Connection
 * 1 = B0 to A
 * 2 = B1 to A
 * 3 = B2 to A
 */
const int S1 =  14; // S1 to GPIO Pin
const int S2 =  16; // S2 to GPIO Pin

void adcset(int port) {
  pinMode(S1, OUTPUT);
  pinMode(S2, OUTPUT);
      
  switch (port){
    case 1:
      digitalWrite(S1, HIGH);
      digitalWrite(S2, LOW);
      Serial.println(&quot;&gt;adc1(B0)&quot;);
      break;
    case 2:
      digitalWrite(S1, LOW);
      digitalWrite(S2, HIGH);
      Serial.println(&quot;&gt;adc2(B1)&quot;);
      break;
    case 3:
      digitalWrite(S1, HIGH);
      digitalWrite(S2, HIGH);
      Serial.println(&quot;&gt;adc3(B2)&quot;);
      break;
    case 0:
      digitalWrite(S1, LOW);
      digitalWrite(S2, LOW);
      Serial.println(&quot;&gt;adc off&quot;);
      break;
  }
}

/******************************************************
 * 
 */
void setup() {
  pinMode(BUILTIN_LED, OUTPUT);
  Serial.begin(115200);
  delay(10);
}

int value = 0;
int count = 0;
int adc = 0;
int batteryMeasMv = -1;

/******************************************************
 * 
 */
void loop()
{
  adcset(0);
  delay(4000);
  delay(interval);
  ++value;
  
  unsigned long currentMillis = millis();
  if(currentMillis - previousMillis &gt;= interval) {
    previousMillis = currentMillis;   
    if (ledState == LOW){
      ledState = HIGH;  // Note that this switches the LED *off*
    } else {
      ledState = LOW;   // Note that this switches the LED *on*
      digitalWrite(BUILTIN_LED, ledState);
      delay(1);
      count += 1;
      Serial.print(&quot;Blink Count: &quot;);
      Serial.println(count);
    }
  }

  // Select ADC source.
  adcset(1);
  delay(5000);
  
  //Battery voltage is divided by an 5.6K/1K resistor divider.
  //ADC: 1024 = 1V
  adc = analogRead(A0);
  batteryMeasMv=(adc*10020*6.6)/10000;
  //                 ^^^^^To correct an error in the resistance value
  Serial.print(&quot;ADC mv: &quot;);
  delay(1);
  Serial.println(batteryMeasMv);

  adcset(2);
  delay(5000);
  adc = analogRead(A0);
  batteryMeasMv=(adc*10020*6.6)/10000;
  Serial.print(&quot;ADC mv: &quot;);
  delay(1);
  Serial.println(batteryMeasMv);

  adcset(3);
  delay(5000);
  adc = analogRead(A0);
  batteryMeasMv=(adc*10020*6.6)/10000;
  Serial.print(&quot;ADC mv: &quot;);
  delay(1);
  Serial.println(batteryMeasMv);
}</pre>
<p>さて、ぼちぼちと回路図書いてみます。</p>
<p>&#160;</p>
<p>書いて、PCB上に配置してみました。あと、温度湿度センサーを載せればOKとします。</p>
<p><img loading="lazy" title="７" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="７" src="./../images/66b3c7c1afec.png" width="640" height="238" /> </p>
<p>リチウムの電池からの電圧と、バックブーストで作られた後の電圧を計測して、あとは照度センサーからのADCを計測したら3チャンネル使い切りました。</p>
<p>&#160;</p>
<p>で、最後にDHT-22 を裏側に乗せました。<a href="./../2015/06/15/esp12%E5%8D%98%E4%BD%93%E3%81%A7%E6%B9%BF%E5%BA%A6%E6%B8%A9%E5%BA%A6%E7%85%A7%E5%BA%A6%E3%81%AEiot%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9.html" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">前回作ったやつ</a>と同じように、ESP8266 の上に載る感じ。</p>
<p>&#160;</p>
<p><img loading="lazy" title="datasheets_sensors_temperature_dht22_pdf" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="datasheets_sensors_temperature_dht22_pdf" src="./../images/datasheets_sensors_temperature_dht22_pdf.png" width="429" height="480" /> </p>
<p><img loading="lazy" title="8" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="8" src="./../images/8.png" width="640" height="235" /></p>
</p>
<p>UART のPIN配列は、ブレッドボードに挿したときに上からLEDが見えるに配列を逆にしました。あと、UART からの信号のDTRを一工夫して、リセットを押さなくても、書き込みモードになるように回路を組んでおしまいです。</p>
<p>&#160;</p>
<p>他、何か忘れているような気もしますが、最後の点検でチェックしていきます。</p>
<p>現時点で、忘れているもの。</p>
<p>・メインスイッチ</p>
<p>・CDS の調整用、半固定抵抗</p>
<p>・WEB アクセスのLEDと、WiFi アクセスのLED （をつけるかどうか）</p>
<p>・EN Pin の配線</p>
<p>&#160;</p>
<p>最後に少し、プログラムを改良したのをメモ。まれに、ADC値が変なので、10回の平均値を出しています。ESP12でテストしているので、ESP13 だとどういう動きになるかは、実際にモノが着てからテスト。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">/*
 ADC Read Sample2.
 Fairchild Semiconductor FSA3357 adc Select.
 Arduino IDE 1.6.5 Hourly Build 2015/06/12 03:13
 esp8266 by ESP8266 Community version 1.6.5 Hourly Build 2015/06/12
 JunkHack 2015.10.11

 --- ex Serial output.
  &gt;adc3(B2)
  ADC3 mv/10: 0 : 476
  1 : 475
  2 : 474
  3 : 474
  4 : 474
  5 : 474
  6 : 474
  7 : 474
  8 : 474
  9 : 474
  3139
  &gt;adc off
 ::

 */

#include &lt;ESP8266WiFi.h&gt;

int ledState = LOW;     
unsigned long previousMillis = 0;
const long interval = 200; //1sec

/******************************************************
 * 
 */
void setup() {
  pinMode(BUILTIN_LED, OUTPUT);
  Serial.begin(115200);
  delay(10);
}

int value = 0;
int count = 0;

/******************************************************
 * 
 */
void loop()
{
  // Select ADC source off.
  adcset(0);
  delay(interval);
  ++value;
  
  unsigned long currentMillis = millis();
  if(currentMillis - previousMillis &gt;= interval) {
    previousMillis = currentMillis;   
    if (ledState == LOW){
      ledState = HIGH;  // Note that this switches the LED *off*
    } else {
      ledState = LOW;   // Note that this switches the LED *on*
      digitalWrite(BUILTIN_LED, ledState);
      delay(1);
      count += 1;
      Serial.print(&quot;Blink Count: &quot;);
      Serial.println(count);
    }
  }

  // Select ADC source.
  adcset(1);
  delay(interval);
  Serial.print(&quot;ADC1 mv/10: &quot;);
  Serial.println(getMv());

  adcset(2);
  delay(interval);
  Serial.print(&quot;ADC2 mv/10: &quot;);
  Serial.println(getMv());

  adcset(3);
  delay(interval);
  Serial.print(&quot;ADC3 mv/10: &quot;);
  Serial.println(getMv());
}

/******************************************************
 * Fairchild Semiconductor FSA3357 adc Select.
 * 0 = No Connection
 * 1 = B0 to A
 * 2 = B1 to A
 * 3 = B2 to A
 */
const int S1 =  14; // S1 to GPIO Pin
const int S2 =  16; // S2 to GPIO Pin

void adcset(int port) {
  pinMode(S1, OUTPUT);
  pinMode(S2, OUTPUT);
      
  switch (port){
    case 1:
      digitalWrite(S1, HIGH);
      delay(10);
      digitalWrite(S2, LOW);
      Serial.println(&quot;&gt;adc1(B0)&quot;);
      break;
    case 2:
      digitalWrite(S1, LOW);
      delay(10);
      digitalWrite(S2, HIGH);
      Serial.println(&quot;&gt;adc2(B1)&quot;);
      break;
    case 3:
      digitalWrite(S1, HIGH);
      delay(10);
      digitalWrite(S2, HIGH);
      Serial.println(&quot;&gt;adc3(B2)&quot;);
      break;
    case 0:
      digitalWrite(S1, LOW);
      delay(10);
      digitalWrite(S2, LOW);
      Serial.println(&quot;&gt;adc off&quot;);
      break;
  }
}

/******************************************************
 * It reads the 10 times of the average value.
 */
int getMv(){
  // correct an error in the resistance value.
  const int CORRECT = 10030;

  int mv = -1;
  int i;
  int adc = 0;
  
  for (i = 0; i&lt;10; i++ ){
    adc = 0;
    
    //Battery voltage is divided by an 5.6K/1K resistor divider.
    //ADC: 1024 = 1V
    adc = analogRead(A0);
    //delay(10);
//    Serial.print(i);
//    Serial.print(&quot; : &quot;);
//    Serial.println(adc);
    mv += (adc*CORRECT*6.6)/10000;
    //                 ^^^^^To correct an error in the resistance value
  }

  mv = mv / 10;

  return mv;
}</pre>
					</div><!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div><!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-1350" class="post-1350 post type-post status-publish format-standard hentry category-backboost category-esp8266 category-parts category-pcb">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="./../1350.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-10-11T23:45:31+09:00">2015年10月11日</time></a> </span><span class="posted-on">更新日:2015年10月11日</span> <span class="categories">  <a href="./../category/backboost.html" rel="category tag noopener noreferrer" data-wpel-link="internal">BackBoost</a>, <a href="./../category/esp8266.html" rel="category tag noopener noreferrer" data-wpel-link="internal">ESP8266</a>, <a href="./../category/parts.html" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a>, <a href="./../category/pcb.html" rel="category tag noopener noreferrer" data-wpel-link="internal">PCB</a></span>			</div><!-- .entry-meta -->

							<h1 class="entry-title"><a href="./../ /1350.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">Auto Program Circuit</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>さて、Eagle の勉強をかねて、ESP8266 でPCBを作っているのですが、だいぶできてきました。</p>
<p>現在のところ、以下のような感じになっています。前回と違うのは、CDS のセンサーに分圧抵抗を入れて、1V 化したものをADC で計測しています。当初半固定抵抗を入れようと思っていたのですが、個体差には目をつぶることにして、安さを追求しました。</p>
<p><img loading="lazy" title="9" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="9" src="./../images/9.png" width="640" height="234" /> </p>
<p>&#160;</p>
<p>CDS は計測してみると、強い光を当てると、抵抗値が150オームくらいから、真っ暗にすると5Mオームくらいまで変動します。</p>
</p>
<p><img loading="lazy" title="10" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="10" src="./../images/10.png" width="488" height="341" /></p>
<p>分圧抵抗は以下のサイトが便利でした。</p>
<p>&#160;<a href="http://sim.okawa-denshi.jp/teikokeisan.htm" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" title="11" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="11" src="./../images/11.png" width="640" height="325" /></a> ちなみに、nodemcu の回路のADC は、以下のようになっています。220k と 100k で分圧して１Vを作って計測しているようです。</p>
<p><img loading="lazy" title="12" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="12" src="./../images/12.png" width="365" height="443" /> </p>
</p>
<p>電圧と、抵抗値を入れると出てくるサイトもあって、上記は以下のように入れると出てきます。</p>
<p><a href="http://keisan.casio.jp/exec/user/1316485613" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" title="13" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="13" src="./../images/13.png" width="344" height="448" /></a></p>
<p>いろいろあって便利ですね。電卓で計算するより便利なので活用しています。</p>
<p>&#160;</p>
<p>さて、前置きが長くなりましたが、 UART を挿しておけば自動的にファームウェアを書きかえれるモードにする方法です。</p>
<p>nodemucu は、回路図があって参考になります。以下のような回路です。</p>
<p><a href="https://raw.githubusercontent.com/nodemcu/nodemcu-devkit/master/Documents/NODEMCU_DEVKIT_SCH.png" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" title="NODEMCU_DEVKIT_SCH_png__2339×1653_" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="NODEMCU_DEVKIT_SCH_png__2339×1653_" src="./../images/nodemcu_devkit_sch_png__23391653_.png" width="528" height="400" /></a> </p>
<p>この回路は、RTS も使っているので、DTR のみというわけにはいきません。自分の持っているUART は RST は出ているんですが、ピンの横から出ていて直接挿すには、改造しないといけません。</p>
<blockquote>
<p><a href="./../2015/05/17/dtr%E4%BB%98%E3%81%AEcp2102-%E3%82%92%E3%82%B2%E3%83%83%E3%83%88.html" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">DTR付のCP2102 をゲット</a></p>
<p><img loading="lazy" title="cp2102a" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="cp2102a" src="./../images/cp2102a.png" width="640" height="397" /> <img loading="lazy" title="cp2102b" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="cp2102b" src="./../images/cp2102b.png" width="640" height="397" /> </p>
</blockquote>
<p>安くて、便利に使っているので２つ持っています。DTR だけでやるには以下のようにやれば良さそうなのですが、具体的な抵抗値と、コンデンサの値が良くわかりません。トランジスタは、PNP 形であれば良さそうです。</p>
</p>
<p><a href="https://github.com/esp8266/Arduino/issues/22" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" title="issues22" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="issues22" src="./../images/issues22.png" width="549" height="480" /></a> </p>
<p>CH_PD は ESP13 や WROOM-02でいえば、EN ピンで普段は10k くらいでプルアップしている抵抗です。なので、R1 と R3 は10K程度でよいということはわかるのですが、R2 が良くわかりません。また、C1 はどのくらいの容量が良いのかも不明です。</p>
<p>&#160;</p>
<p>プログラムを書き込みモードにする原理は、起動時にGPIO0 PinがGND に落ちていればいいので、R2 は10K 程度でよいのではと考えています。CH_PD にコンデンサを挟む原理は、再起動させる働きがあると理解すればよいのでしょうか？</p>
<p>&#160;</p>
<p>一番シンプルな回路として、以下があります。ダイオードとコンデンサだけで、構成された回路です。</p>
<p>&#160;</p>
<p> <a href="http://www.esp8266.com/wiki/doku.php?id=setup-windows-compiler-esp8266" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" title="setup-windows-compiler-esp8266__ESP8266_Support_WIKI_" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="setup-windows-compiler-esp8266__ESP8266_Support_WIKI_" src="./../images/setupwindowscompileresp8266__esp8266_support_wiki_.png" width="640" height="451" /></a>   </p>
<p>これが動作するのであれば、今回採用したいと思っています。</p>
<p>で、試してみました。手持ちには、1uf と 0.01uf しかないので、1uf で試しました。どうやら、これで書き込みモードになるようです。1uf だと３０回の内、11回が成功し19回は失敗しました。3分の１の成功率です。もう少し、精度があがればいいのですが。</p>
<p>0.1uf だとちゃんと動くのかどうかは不明です。</p>
<p>コンデンサの数を並列に２，３と増やすと１００％成功しますが、シリアルからコンソールを開くと、100%Boot せず、リセットをかけてもだめです。動いているときにシリアルを開いてもシステムが止まります。</p>
<p>&#160;</p>
<p>どっかに0.1uf ないか探してみます。</p>
<p>ありましたが、1uF が一番成績が良かったです。</p>
<p><img loading="lazy" title="Scan_16" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="Scan_16" src="./../images/scan_16.png" width="640" height="307" /> </p>
<p>成功するときは、以下のようになります。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">esptool v0.4.5 - (c) 2014 Ch. Klippel &lt;ck@atelier-klippel.de&gt;
    setting board to ck
    setting baudrate from 115200 to 115200
    setting port from /dev/tty.usbserial to /dev/cu.SLAB_USBtoUART
    setting address from 0x00000000 to 0x00000000
    espcomm_upload_file
    stat /var/folders/9c/0bsgxjzx63s7xhc_zz12jyp40000gn/T/build8239373840747412004.tmp/sample_FSA3357_adc_Select.cpp.bin success
opening port /dev/cu.SLAB_USBtoUART at 115200
    tcgetattr
    tcsetattr
    serial open
opening bootloader
resetting board
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
    espcomm_send_command: receiving 2 bytes of data
    espcomm_send_command: receiving 2 bytes of data
    espcomm_send_command: receiving 2 bytes of data
    espcomm_send_command: receiving 2 bytes of data
    espcomm_send_command: receiving 2 bytes of data
    espcomm_send_command: receiving 2 bytes of data
    espcomm_send_command: receiving 2 bytes of data
    espcomm_send_command: receiving 2 bytes of data
    espcomm_open
Uploading 297360 bytes from /var/folders/9c/0bsgxjzx63s7xhc_zz12jyp40000gn/T/build8239373840747412004.tmp/sample_FSA3357_adc_Select.cpp.bin to flash at 0x00000000
    erasing flash
    size: 048990 address: 000000
    first_sector_index: 0
    total_sector_count: 73
    head_sector_count: 16
    adjusted_sector_count: 57
    adjusted_size: 039000
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
    setting timeout 10000
    setting character timeout 100
    done
    setting timeout 1
    setting character timeout 1
    done
    espcomm_send_command: receiving 2 bytes of data
    writing flash
...................................................................................................................................................................................................................................................................................................
starting app without reboot
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
    espcomm_send_command: receiving 2 bytes of data
closing bootloader</pre>
<p>失敗するときは、以下のよう。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">esptool v0.4.5 - (c) 2014 Ch. Klippel &lt;ck@atelier-klippel.de&gt;
    setting board to ck
    setting baudrate from 115200 to 115200
    setting port from /dev/tty.usbserial to /dev/cu.SLAB_USBtoUART
    setting address from 0x00000000 to 0x00000000
    espcomm_upload_file
    stat /var/folders/9c/0bsgxjzx63s7xhc_zz12jyp40000gn/T/build8239373840747412004.tmp/sample_FSA3357_adc_Select.cpp.bin success
opening port /dev/cu.SLAB_USBtoUART at 115200
    tcgetattr
    tcsetattr
    serial open
opening bootloader
resetting board
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
resetting board
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
    serialport_receive_C0: 3E instead of C0
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
resetting board
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
trying to connect
    setting character timeout 0
    done
    setting character timeout 1
    done
    espcomm_send_command: sending command header
    espcomm_send_command: sending command payload
    serialport_receive_C0: 41 instead of C0
warning: espcomm_sync failed
error: espcomm_open failed</pre>
<p>&#160;</p>
<p>違う方法を模索しますか。まず、nodemcu でも採用されているNPNトランジスタを２つと抵抗２つを使ったもの。</p>
<p>自分のUART には、RTS があるのですがピンから出して配線。NPN トランジスタは、以下の左から2番目の2SC945を２つ使いました。たぶん、かなりの年代モノでジャンク箱にあったものです。</p>
<p><img loading="lazy" title="Scan_17" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="Scan_17" src="./../images/scan_17.png" width="640" height="311" /> </p>
<p>抵抗は、手持ちの適当なもの5.5k と 6.7k をつけました。当初、IDE (arduino に ESP8266 を組み込んだもの)からは、反応がなく「うーん、これもだめなの？」と思っていましたが、設定を以下のようにいじったら問題なくいけました。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">---- esp8266/hardware/esp8266/1.6.5-947-*****/boards.txt
##############################################################
generic.name=Generic ESP8266 Module

generic.upload.tool=esptool
generic.upload.speed=115200
generic.upload.resetmethod=nodemcu
generic.upload.maximum_size=434160
generic.upload.maximum_data_size=81920
generic.upload.wait_for_upload_port=true
generic.serial.disableDTR=false
generic.serial.disableRTS=false
::</pre>
<p>アプリケーションを再起動しないと駄目なようです。設定しても反映されないというなぜに陥りました。</p>
<p>設定が反映されているかどうかは、書き込み時の冒頭の赤い部分に出る以下で見分けがつきます。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">esptool v0.4.6 - (c) 2014 Ch. Klippel &lt;ck@atelier-klippel.de&gt;
    setting board to nodemcu★
    setting baudrate from 115200 to 115200
    setting port from /dev/tty.usbserial to /dev/cu.SLAB_USBtoUART
    setting address from 0x00000000 to 0x00000000
    espcomm_upload_file
    stat /var/folders/9c/0bsgxjzx63s7xhc_zz12jyp40000gn/T/build6222680945723527651.tmp/sample_FSA3357_adc_Select.cpp.bin success
opening port /dev/cu.SLAB_USBtoUART at 115200
    tcgetattr
    tcsetattr
    serial open</pre>
<p>esptool-ck は現時点で最新の0.4.6に入れ替えておきました。</p>
<p>&#160;</p>
<p>とにかく、これでリセットボタンや、GPIO0 をGND に落としたり、スイッチをつけている場合はそれを押さなくてもよいよいになります。</p>
<p>&#160;</p>
<p>今回の組み込みには、RTS を使わないDTRだけを使ったものにしたいと思いますので、PNPとコンデンサを使ったものをなんとか成功させたいです。一度、組み込んだのですがうまく動作しなくて。もしかしたら、この設定が反映されてないかもしれないので、もう一度組み込んでみます。</p>
<p>&#160;</p>
<p>やっぱりだめでした。うーん。作者が言っているやつなのになぁー。</p>
					</div><!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div><!-- .entry-wrapper -->
</article><!-- #post-## -->

			
			
	<nav class="navigation posts-navigation" role="navigation" aria-label="投稿">
		<h2 class="screen-reader-text">投稿ナビゲーション</h2>
		<div class="nav-links"><div class="nav-previous"><a href="./../category/backboost/page/2.html" data-wpel-link="internal" rel="noopener noreferrer">過去の投稿</a></div></div>
	</nav>
		
		</main><!-- #main -->
	</section><!-- #primary -->


	</div><!-- #content -->

	<footer id="colophon" class="site-footer wrap" role="contentinfo">
		<div class="site-info">
			Copyleft - all rights reversed.
			<span class="sep"> | </span>
			JunkHack 2011 - 2021
			<span class="sep"> | </span>
			<a href="https://junkhack.gpl.jp/about-junkhack/" data-wpel-link="internal" rel="noopener noreferrer">運営者情報<span class="gf"></a><span class="sep"> | </span>
			<a href="https://junkhack.gpl.jp/sendmail/" data-wpel-link="internal" rel="noopener noreferrer">お問い合わせ<span class="gf"></a><span class="sep"> | </span>
			<a href="https://junkhack.gpl.jp/privacy/" data-wpel-link="internal" rel="noopener noreferrer">プライバシーポリシー<span class="gf"></a>
		</div><!-- .site-info -->

	</footer><!-- #colophon -->
</div><!-- #page -->

        <div id="wpfront-scroll-top-container">
            <img src="./../images/1.png" alt="" />        </div>
                <script type="text/javascript">
            function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();
        </script>
        <script type='text/javascript' src='./../js/core.min.js' id='jquery-ui-core-js'></script>
<script type='text/javascript' src='./../js/menu.min.js' id='jquery-ui-menu-js'></script>
<script type='text/javascript' src='./../js/wp-polyfill.min.js' id='wp-polyfill-js'></script>
<script type='text/javascript' id='wp-polyfill-js-after'>
( 'fetch' in window ) || document.write( '<script src="https://hack.gpl.jp/wp-includes/js/dist/vendor/wp-polyfill-fetch.min.js?ver=3.0.0"></scr' + 'ipt>' );( document.contains ) || document.write( '<script src="https://hack.gpl.jp/wp-includes/js/dist/vendor/wp-polyfill-node-contains.min.js?ver=3.42.0"></scr' + 'ipt>' );( window.DOMRect ) || document.write( '<script src="https://hack.gpl.jp/wp-includes/js/dist/vendor/wp-polyfill-dom-rect.min.js?ver=3.42.0"></scr' + 'ipt>' );( window.URL && window.URL.prototype && window.URLSearchParams ) || document.write( '<script src="https://hack.gpl.jp/wp-includes/js/dist/vendor/wp-polyfill-url.min.js?ver=3.6.4"></scr' + 'ipt>' );( window.FormData && window.FormData.prototype.keys ) || document.write( '<script src="https://hack.gpl.jp/wp-includes/js/dist/vendor/wp-polyfill-formdata.min.js?ver=3.0.12"></scr' + 'ipt>' );( Element.prototype.matches && Element.prototype.closest ) || document.write( '<script src="https://hack.gpl.jp/wp-includes/js/dist/vendor/wp-polyfill-element-closest.min.js?ver=2.0.2"></scr' + 'ipt>' );( 'objectFit' in document.documentElement.style ) || document.write( '<script src="https://hack.gpl.jp/wp-includes/js/dist/vendor/wp-polyfill-object-fit.min.js?ver=2.3.4"></scr' + 'ipt>' );
</script>
<script type='text/javascript' src='./../js/dom-ready.min.js' id='wp-dom-ready-js'></script>
<script type='text/javascript' src='./../js/hooks.min.js' id='wp-hooks-js'></script>
<script type='text/javascript' src='./../js/i18n.min.js' id='wp-i18n-js'></script>
<script type='text/javascript' id='wp-i18n-js-after'>
wp.i18n.setLocaleData( { 'text direction\u0004ltr': [ 'ltr' ] } );
</script>
<script type='text/javascript' id='wp-a11y-js-translations'>
( function( domain, translations ) {
	var localeData = translations.locale_data[ domain ] || translations.locale_data.messages;
	localeData[""].domain = domain;
	wp.i18n.setLocaleData( localeData, domain );
} )( "default", {"translation-revision-date":"2021-05-20 01:00:08+0000","generator":"GlotPress\/3.0.0-alpha.2","domain":"messages","locale_data":{"messages":{"":{"domain":"messages","plural-forms":"nplurals=1; plural=0;","lang":"ja_JP"},"Notifications":["\u901a\u77e5"]}},"comment":{"reference":"wp-includes\/js\/dist\/a11y.js"}} );
</script>
<script type='text/javascript' src='./../js/a11y.min.js' id='wp-a11y-js'></script>
<script type='text/javascript' id='jquery-ui-autocomplete-js-extra'>
/* <![CDATA[ */
var uiAutocompleteL10n = {"noResults":"\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002","oneResult":"1\u4ef6\u306e\u7d50\u679c\u304c\u898b\u3064\u304b\u308a\u307e\u3057\u305f\u3002\u4e0a\u4e0b\u30ad\u30fc\u3092\u4f7f\u3063\u3066\u64cd\u4f5c\u3067\u304d\u307e\u3059\u3002","manyResults":"%d\u4ef6\u306e\u7d50\u679c\u304c\u898b\u3064\u304b\u308a\u307e\u3057\u305f\u3002\u4e0a\u4e0b\u30ad\u30fc\u3092\u4f7f\u3063\u3066\u64cd\u4f5c\u3067\u304d\u307e\u3059\u3002","itemSelected":"\u9805\u76ee\u3092\u9078\u629e\u3057\u307e\u3057\u305f\u3002"};
/* ]]> */
</script>
<script type='text/javascript' src='./../js/autocomplete.min.js' id='jquery-ui-autocomplete-js'></script>
<script type='text/javascript' src='./../js/wpfront-scroll-top.min.js' id='wpfront-scroll-top-js'></script>
<script type='text/javascript' src='./../js/hew.js' id='hew-scripts-js'></script>
<script type='text/javascript' src='./../js/navigation.js' id='hew-navigation-js'></script>
<script type='text/javascript' src='./../js/skip-link-focus-fix.js' id='hew-skip-link-focus-fix-js'></script>
<script type='text/javascript' src='./../js/wp-embed.min.js' id='wp-embed-js'></script>

</body>
</html>

<!--This file was exported by "Export WP Page to Static HTML" plugin which created by ReCorp (https://myrecorp.com) -->