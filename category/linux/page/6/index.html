<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php">

<title>Linux &#8211; ページ 6 &#8211; JunkHack</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="/feed">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; コメントフィード" href="/comments/feed">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; Linux カテゴリーのフィード" href="/category/linux/feed">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}</style>
	<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="export-wp-page-to-static-html-css" href="/wp-content/plugins/export-wp-page-to-static-html-pro-premium/public/css/export-wp-page-to-static-html-public.css?ver=1.0.4" type="text/css" media="all">
<link rel="stylesheet" id="wpel-style-css" href="/wp-content/plugins/wp-external-links/public/css/wpel.css?ver=2.48" type="text/css" media="all">
<link rel="stylesheet" id="wpfront-scroll-top-css" href="/wp-content/plugins/wpfront-scroll-top/css/wpfront-scroll-top.min.css?ver=2.0.4.04013" type="text/css" media="all">
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/plugins/ccrw_related/css/frontend-style.css?ver=0.1.0" type="text/css" media="all">
<link rel="stylesheet" id="hew-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="/wp-content/themes/hew-wpcom/genericons/genericons.css?ver=3.4.1" type="text/css" media="all">
<link rel="stylesheet" id="hew-style-css" href="/wp-content/themes/hew-wpcom/style.css?ver=5.7.2" type="text/css" media="all">
		<script>
			/* <![CDATA[ */
			var rcewpp = {
				"ajax_url":"/wp-admin/admin-ajax.php",
				"nonce": "c8372d57e1",
				"home_url": "/",
				"settings_icon": '/wp-content/plugins/export-wp-page-to-static-html-pro-premium/admin/images/settings.png',
				"settings_hover_icon": '/wp-content/plugins/export-wp-page-to-static-html-pro-premium/admin/images/settings_hover.png'
			};
			/* ]]\> */
		</script>
		<script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-3.5.1.min.js" id="jquery-core-js"></script>
<script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-migrate-3.3.0.min.js" id="jquery-migrate-js"></script>
<script type="text/javascript" src="/wp-content/plugins/export-wp-page-to-static-html-pro-premium/public/js/export-wp-page-to-static-html-public.js?ver=1.0.4" id="export-wp-page-to-static-html-js"></script>
<link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/categories/47">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.7.2">
<style id="uagb-style-conditional-extension">@media (min-width: 1025px){body .uag-hide-desktop.uagb-google-map__wrap,body .uag-hide-desktop{display:none}}@media (min-width: 768px) and (max-width: 1024px){body .uag-hide-tab.uagb-google-map__wrap,body .uag-hide-tab{display:none}}@media (max-width: 767px){body .uag-hide-mob.uagb-google-map__wrap,body .uag-hide-mob{display:none}}</style>
<script data-ad-client="ca-pub-2711753458083215" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-161935417-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161935417-2');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-13YWDXYQE2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-13YWDXYQE2');
</script>
<body class="archive paged category category-linux category-47 paged-6 category-paged-6 has-sidebar has-header-image">
<div id="page" class="hfeed site">
		<div id="widgets-wrapper" class="hide">
		
<div id="secondary" class="wrap top-widget-area" role="complementary">
		<div id="sidebar-1" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="/">
				<label>
					<span class="screen-reader-text">検索:</span>
					<input type="search" class="search-field" placeholder="検索&hellip;" value="" name="s">
				</label>
				<input type="submit" class="search-submit" value="検索">
			</form></aside>	</div>
<!-- #first .widget-area -->
	
	
	
	</div>
<!-- #secondary -->
	</div>
	
	<a class="skip-link screen-reader-text" href="#content">コンテンツへ移動</a>

	<header id="masthead" class="site-header" role="banner">
					<a class="site-logo" href="/" title="JunkHack" rel="home noopener noreferrer" data-wpel-link="internal">
				<img src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="no-grav header-image">
			</a>
		
		<div class="site-branding">
			<h1 class="site-title"><a href="/" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
			<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
		</div>

					<nav id="site-navigation" class="main-navigation" role="navigation">
				<button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button>
				<div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu">
<li id="menu-item-10711" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10711"><a href="/list.html" data-wpel-link="internal" rel="noopener noreferrer">LIST</a></li>
<li id="menu-item-10712" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10712"><a href="/status.html" data-wpel-link="internal" rel="noopener noreferrer">Status</a></li>
<li id="menu-item-10713" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10713"><a href="https://junkhack.gpl.jp/sendmail" data-wpel-link="internal" rel="noopener noreferrer">CONTACT</a></li>
</ul></div>			</nav><!-- #site-navigation -->
		
		
				<div class="toggle-wrapper">
			<a href="#" class="widgets-toggle toggle-button" title="ウィジェット">
				<span class="screen-reader-text">ウィジェット</span>
			</a>
		</div>
		
	</header><!-- #masthead -->

	<div id="content" class="site-content">

	<section id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">カテゴリー: <span>Linux</span>
</h1>			</header><!-- .page-header -->

						
				
<article id="post-9464" class="post-9464 post type-post status-publish format-standard has-post-thumbnail hentry category-linux category-wordpress category-speeding-up">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="/9464.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2020-09-10T02:27:32+09:00">2020年9月10日</time></a> </span><span class="posted-on">更新日:2020年9月10日</span> <span class="categories">  <a href="/category/linux" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a>, <a href="/category/speeding-up" rel="category tag noopener noreferrer" data-wpel-link="internal">高速化</a></span>			</div>
<!-- .entry-meta -->

							<h1 class="entry-title"><a href="/9464.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">Termuxでのスマホサーバ、SSLアクセスでも耐えれそうかな？</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			
<p>TermuxでのLet&#8217;s Encrypt　SSL化がやっとできたのでメモっておきます！</p>



<p>まず心配だったのは、SSLアクセスしたときのレスポンスですが、まぁ我慢どころといった感じでしょうか。</p>



<figure class="wp-block-image size-large"><img src="/wp-content/uploads/2020/09/webpagetest_test_details_-_tokyo___jh_gpl_jp__-_09_10_20_00_45_09.png?w=937" alt="" class="wp-image-5982"></figure>



<p>非SSLと比べると、接続には少し時間がかかっています。実際にスマホからSIM通信してみると、若干ワンテンポ送れる感じです。</p>



<p>証明書は、Let&#8217;s Encrypt でこれは３ヶ月ごとに更新しないといけないので自動化が必須となってきます。手動でやってもいいのですが、絶対面倒になって証明書を切らしてしまうので。で、自動化には <a rel="noreferrer noopener external" href="https://certbot.eff.org/" target="_blank" data-wpel-link="external" class="wpel-icon-right">certbot<span class="wpel-icon wpel-image wpel-icon-1"></span></a> のスクリプトが有名なんですが、これは依存関係などがあったり、root （スクリプト中で su したり）が必須とかで、Termux では動きません。動かす方法もあるのでしょうが、世の中にはもっと小さな自動化ツールがありました！</p>



<p><a rel="noreferrer noopener external" href="https://github.com/diafygi/acme-tiny" target="_blank" data-wpel-link="external" class="wpel-icon-right">acme-tiny<span class="wpel-icon wpel-image wpel-icon-1"></span></a> っていうPython製の自動化PGです。pythonとopenssl があれば動くそうです。pip で入れて見ます。</p>



<h3>ステップ１ pythonを入れる</h3>



<p>pythonが必要なので、なければ入れます。今回は、もう入れてあるので次です。</p>



<pre class="wp-block-code"><code>$ dpkg-query -l | grep python
ii  python             3.8.5             aarch64      Python 3 programming language intended to enable clear programs

$ pkg install python -y</code></pre>



<h3>ステップ２　PIPで acme-tiny を入れる</h3>



<pre class="wp-block-code"><code>$ pip install acme-tiny</code></pre>



<p>pip が古いとか言われたら、以下で。</p>



<pre class="wp-block-code"><code>$ python3 -m pip install --upgrade pip</code></pre>



<p>以下に入るようです。</p>



<pre class="wp-block-code"><code>$ which acme-tiny
/data/data/com.termux/files/usr/bin/acme-tiny

$ find $PREFIX -name *acme*
/data/data/com.termux/files/usr/bin/acme-tiny
/data/data/com.termux/files/usr/lib/python3.8/site-packages/acme_tiny.py
/data/data/com.termux/files/usr/lib/python3.8/site-packages/__pycache__/acme_tiny.cpython-38.pyc
/data/data/com.termux/files/usr/lib/python3.8/site-packages/acme_tiny-4.1.0.dist-info</code></pre>



<h3>ステップ３　Let&#8217;s Encryptアカウントの秘密鍵</h3>



<p>どこか適当な場所にディレクトリを作って、そこで作業します。</p>



<pre class="wp-block-code"><code>$ cd
$ mkdir ssl
$ cd ssl
$ openssl genrsa 4096 &gt; account.key</code></pre>



<h3>ステップ４　ドメイン用の秘密鍵を作成</h3>



<p>ドメイン名は、読み替えてみてください。</p>



<pre class="wp-block-code"><code>$ openssl genrsa 4096 &gt; www.example.jp.key</code></pre>



<h3>ステップ５　ドメインの証明書署名要求（CSR）を作成</h3>



<pre class="wp-block-code"><code>シングルドメイン
$ openssl req -new -sha256 -key www.example.jp.key -subj "/CN=www.example.jp" &gt; www.example.jp.csr</code></pre>



<p>サブドメインのワイルドカード証明書はどうやって作るのかまだ知りません。課題です。</p>



<h3>ステップ６　証明書に署名してもらう</h3>



<pre class="wp-block-code"><code>$ mkdir -p /data/data/com.termux/files/home/【WEBROOT】/.well-known/acme-challenge/

$ acme-tiny --disable-check --account-key ./account.key --csr ./www.example.jp.csr --acme-dir /data/data/com.termux/files/home/【WEBROOT】/.well-known/acme-challenge/ &gt; ./www.example.jp.crt</code></pre>



<p>ここで、&#8211;disable-check　を入れていますがこれは先日記載したUターンNAT（ヘアピンNAT）ができないため、自分自身のWEBにアクセスできないからです。そういう問題がない場合は、削除してください。</p>



<p>こんな感じで出来ると思います。crtができない場合は何かが悪いです。ログにヒントがありますので慌てず、探りましょう！</p>



<pre class="wp-block-code"><code>.
├── account.key
├── www.example.jp.crt　署名された証明書
├── www.example.jp.csr
└──  www.example.jp.key　鍵

.WEBROOT
    └── .well-known
        └── acme-challenge
           └──xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code></pre>



<h3>ステップ７　nginxの設定</h3>



<p>設定ファイル抜粋。ルータとtermuxはポート転送しています。</p>



<pre class="wp-block-code"><code>http {
：：（略）
    ssl_session_timeout 30m;
    ssl_session_cache   shared:SSL:10m;
    ssl_session_tickets off;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256;
：：（略）
server {
     listen      8443;
：：（略）
     ssl_certificate     /data/data/com.termux/files/home/ssl/www.example.jp.crt;
     ssl_certificate_key /data/data/com.termux/files/home/ssl/www.example.jp.key;
：：（略）
</code></pre>



<p>なぜか、location で、.well-known/acme-challenge/　の場所が以下のように指定したら、アクセスできませんでした。なので、これは消して、実際のWEBROOTに/.well-known/acme-challenge/を作りました。</p>



<pre class="wp-block-code"><code>location ^~ /.well-known/acme-challenge/ {
    root /data/data/com.termux/files/home/【acme-challengeがあるパス】;
}
location = /.well-known/acme-challenge/ {
    return 404;
}</code></pre>



<p>以下の評価が先にマッチしてしまって、これも一時的に消しました。</p>



<pre class="wp-block-code"><code>location ~ /\. {
    return 404;
}</code></pre>



<p>nginxの設定、不慣れなんでどこかおかしいんでしょうね。</p>



<p>ワイルドカード証明書が取得できるようにしたら、cronに定期実行してもらおうと思いますが、もう少しいろいろ試してみてからにします。</p>



<p>SSLのチェックも良さそうです。</p>



<figure class="wp-block-image size-large"><img src="/wp-content/uploads/2020/09/ssl_server_test__jh_gpl_jp__powered_by_qualys_ssl_labs_.png?w=1024" alt="" class="wp-image-5993"></figure>



<p>PageSpeed Insightsのモバイルのスコアも良さそうです。</p>



<figure class="wp-block-image size-large"><img src="/wp-content/uploads/2020/09/pagespeed_insights-1.png?w=744" alt="" class="wp-image-5995"></figure>



<p>PC版は１００点出ました！</p>



<figure class="wp-block-image size-large"><img src="/wp-content/uploads/2020/09/pagespeed_insights-2.png?w=737" alt="" class="wp-image-5997"></figure>



<p>ということで、Termux のnginxとphp-fpmで無料の証明書を入れて速度的にも問題なさそうかなという感じです。</p>



<p>あとは、今回出たもろもろの問題をクリアにしてマクロを定期実行できればOKです。ぼちぼちやっていきます。でも、10月はじめまでには、移行完了しないといけませんので、それまでにはCDN問題もクリアして試してみたいです。</p>



<h3>良くわからんこと！</h3>



<p>・nginxのlocationのマッチはどうなってるのか？</p>



<p>・ワイルドカード証明書はどうやって作るのか？CSRの作り方っぽいが？</p>



<p>・リバースプロキシーでSSLアクセスするにはどうしたら？</p>
					</div>
<!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div>
<!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-5929" class="post-5929 post type-post status-publish format-standard hentry category-linux category-osx category-wordpress">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="/5929.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2020-09-07T17:01:27+09:00">2020年9月7日</time></a> </span><span class="posted-on">更新日:2020年9月7日</span> <span class="categories">  <a href="/category/linux" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/osx" rel="category tag noopener noreferrer" data-wpel-link="internal">osx</a>, <a href="/category/wordpress" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>			</div>
<!-- .entry-meta -->

							<h1 class="entry-title"><a href="/5929.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">ポートフォワードの経路で、Uターン NATとかヘアピンNATが使えないルータの場合のあれこれ</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			
<p>先日、以下のように困っていました。</p>



<blockquote class="wp-block-quote"><p><a rel="noreferrer noopener" href="/2020/08/31/termux%e3%81%aeapache2phpmariadb%e3%81%ae%e3%83%81%e3%83%a5%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0%e5%89%8d%e3%81%aewordpress%e3%81%ae%e9%80%9f%e5%ba%a6%e3%81%a8%e3%81%8b/" target="_blank" data-wpel-link="internal">Termuxのapache2+php+mariadbのチューニング前のwordpressの速度とか</a><br>：：<br>まぁ、速度的なことより困っていることがあります。それは、ローカルのマシンから、termux上で動作しているwordpressにグローバルIPでアクセスできないことです。この場合、ルータの管理画面にアクセスしちゃうんで、どうしようかなと。こういうのなんていうんでしたっけか？　とにかく、今の拠点のルータ（PR-400KI）は、内側ネットワークから外側のグローバルアドレスにアクセスしたものを、変換（最終的にサーバのプライベートアドレスに変換）してくれないのです。</p></blockquote>



<p>これ、言葉で書くとよくわかりませんが、どんな問題かというと以下のようになります。</p>



<figure class="wp-block-image size-large"><img src="/wp-content/uploads/2020/09/untitled_diagram_drawio_-_diagrams_net.png?w=607" alt="" class="wp-image-5932"></figure>



<p>こういう表現として、<strong><a rel="noreferrer noopener external" href="https://www.google.com/search?q=U%E3%82%BF%E3%83%BC%E3%83%B3NAT+%E3%81%A8%E3%81%AF" target="_blank" data-wpel-link="external" class="wpel-icon-right">UターンNAT<span class="wpel-icon wpel-image wpel-icon-1"></span></a></strong>とか、<strong><a rel="noreferrer noopener external" href="https://www.google.com/search?q=%E3%83%98%E3%82%A2%E3%83%94%E3%83%B3NAT+%E3%81%A8%E3%81%AF" target="_blank" data-wpel-link="external" class="wpel-icon-right">ヘアピンNAT<span class="wpel-icon wpel-image wpel-icon-1"></span></a></strong>とか呼ぶようです。これが出来るルータとできないルータがあり、NTTから借りているルータではできませんでした。いろいろ解決方法があるとは思いますが、一番簡単なのは、クライアントPCをVPNで外部のネットワークからアクセスさせる方法です。つくば大学の<strong><a rel="noreferrer noopener external" href="https://www.vpngate.net/ja/" target="_blank" data-wpel-link="external" class="wpel-icon-right">VPN Gate<span class="wpel-icon wpel-image wpel-icon-1"></span></a></strong>を使えば簡単に解決できますが、インターネット経路となりいまいちです。プレイベート間の通信なのでリバースプロキシを経由する方法が良さそうです。ポート変換がなければ、hosts を書き換えるか、内部DNSを立ち上げればいいのですが、今回の場合は、スマホサーバで提供しているポートは8080です。80と8080を対応付ける必要があり、hosts だけでは無理なので、リバースプロキシを通して、アクセスしてみることにします。</p>



<p>　ブログの更新は、クライアントPCからしか行わないのでこのPC中に設置してみました。もちろんリバースプロキシを分離して、内部DNSを立ち上げれば、理論上は何台でも違うポートとIPを使って好きなドメインでアクセスできます。そのうち、IoTデバイスとか、スマホサーバでクラスタリングとかロードバランサーとか使い出したら内部DNSやリバースプロキシは欲しくなってくるのですが、それはその時にまた考えることにします。</p>



<p>　ということで、クライアントにリバースプロキシを作って、スマホサーバの8080ポートで提供されているWordPress にアクセスしてみることにします。幸い、クライアントはMacなので nginx とかで簡単に作れます。</p>



<h2>Macでリバースプロキシをnginxで作る</h2>



<figure class="wp-block-image size-large"><img src="/wp-content/uploads/2020/09/untitled_diagram_drawio_-_diagrams_net-1.png?w=607" alt="" class="wp-image-5935"></figure>



<p>経路のイメージはこんな感じでしょうか。まずは、nginx を入れます。</p>



<pre class="wp-block-code"><code>$ brew install nginx</code></pre>



<p>起動と再起動、停止は以下のようにします。</p>



<pre class="wp-block-code"><code>・起動
$ sudo nginx
・再起動
$ sudo nginx -s reload
・停止
$ sudo nginx -s stop</code></pre>



<p>設定を以下のように書き換えます。server_nameや、proxy_passのIPやポートなど読み替えて書き換えてみてください。</p>



<pre class="wp-block-code"><code>/usr/local/etc/nginx/nginx.conf
::
worker_processes 1;
error_log /usr/local/var/log/nginx/error.log;

events {
  worker_connections  1024;
}

http {
  # This should be in the same directory as this conf
  # e.g. /usr/local/etc/nginx
  include       mime.types;
  default_type  application/octet-stream;
  
  # Note this log_format is named 'main', and is used with the access log below
  log_format   main '$remote_addr - $remote_user &#091;$time_local]  $status '
    '"$request" $body_bytes_sent "$http_referer" '
    '"$http_user_agent" "$http_x_forwarded_for"';

  sendfile        on;
  keepalive_timeout  65;

  # Without this I got this error: 'upstream sent too big header
  # while reading response header from upstream'
  proxy_buffer_size   128k;
  proxy_buffers   4 256k;
  proxy_busy_buffers_size   256k;

  server {
      listen 80;
      server_name jh.gpl.jp;
      proxy_set_header    Host    $host;
      proxy_set_header    X-Real-IP    $remote_addr;
      proxy_set_header    X-Forwarded-Host       $host;
      proxy_set_header    X-Forwarded-Server    $http_host;
      proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
      access_log /usr/local/var/log/nginx/reverse-proxy.access.log  main;

      location / {
          proxy_pass         http://192.168.1.38:8080;
      }
  }
}</code></pre>



<p>hosts を書き換えます。</p>



<pre class="wp-block-code"><code>$ cat /etc/hosts
::
127.0.0.1 jh.gpl.jp</code></pre>



<p>nginx を再起動して、ブラウザでドメインに対してアクセスすればOKです。</p>



<p>ちなみに、wp-config.php に以下を追記すると、接続元が192.168.1.26 の時だけWordPress のドメイン名が www.gpl.jp に書き換わります。もちろん、アクセスするクライアントのhosts は書き換える必要があります。</p>



<pre class="wp-block-code"><code>if( $_SERVER&#091;'REMOTE_ADDR'] == '192.168.1.26' ){
    define('WP_HOME','');
    define('WP_SITEURL','');
}</code></pre>



<p>ということで、macos で簡単にリバースプロキシーを立ち上げて、内部ネットワークの違うポートで提供されているWordPress にアクセスする方法でした。</p>



<p>Lan内部のスマホからもアクセスしたい場合は、内部DNSをDHCPで配布して、リバースプロキシーと対応付けしないとだめですので、完璧を求めるならそれらが必要です。そのうち、作る機会があれば紹介したいなと思います。</p>



<p></p>
					</div>
<!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div>
<!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-5911" class="post-5911 post type-post status-publish format-standard hentry category-blog category-linux category-wordpress category-speeding-up">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="/5911.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-09-06T19:29:10+09:00">2020年9月6日</time><time class="updated" datetime="2021-06-02T05:43:58+09:00">2021年6月2日</time></a> </span><span class="posted-on">更新日:2021年6月2日</span> <span class="categories">  <a href="/category/blog" rel="category tag noopener noreferrer" data-wpel-link="internal">Blog</a>, <a href="/category/linux" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a>, <a href="/category/speeding-up" rel="category tag noopener noreferrer" data-wpel-link="internal">高速化</a></span>			</div>
<!-- .entry-meta -->

							<h1 class="entry-title"><a href="/5911.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">Termuxのapache2+php7+mariadb10 環境でwordpressの表示スコア</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			
<p>とりあえず、１つの指標としてメモしておくことにします。まず、改善結果から。データ量は、今見ているこのブログの過去記事、約４００件のデータでテンプレートは、<a href="https://wordpress.com/theme/hew" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">Hew<span class="wpel-icon wpel-image wpel-icon-1"></span></a>　です。TOPの表示記事数は３です。スマホ側は、UmidigiF2にapache2+php7+mariadb10の環境となります。ClassicPressではなく、WordPress最新5.5.1です。</p>



<div class="wp-block-image"><figure class="aligncenter"><img src="/wp-content/uploads/2020/09/webpagetest_test_details_-_tokyo___jh_gpl_jp__-_09_06_20_18_04_20.png" alt="WebPageTest_Test_Details_-_Tokyo___jh_gpl_jp__-_09_06_20_18_04_20" class="wp-image-5913"></figure></div>



<p>改善前は以下です。</p>



<figure class="wp-block-image"><img src="/wp-content/uploads/2020/09/webpagetest_test_details_-_tokyo___jh_gpl_jp__-_09_05_20_15_15_05-1.png" alt="WebPageTest_Test_Details_-_Tokyo___jh_gpl_jp__-_09_05_20_15_15_05" class="wp-image-5915"></figure>



<p>2.2秒くらいから、1.3秒くらいまで改善しました。これは、キャッシュ化の効果です。キャッシュさせるのは、何がいいのか迷いましたが一番シンプルそうな、「<strong>Simple Cache</strong>」というのを使いました。</p>



<figure class="wp-block-image"><a href="https://ja.wordpress.org/plugins/simple-cache/" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img src="/wp-content/uploads/2020/09/e38395e3829ae383a9e382afe38299e382a4e383b3_e280b9_junkhack_e28094_wordpress.png" alt="プラグイン_‹_JunkHack_—_WordPress" class="wp-image-5917"></a></figure>



<p>Jetpack の全ての機能を試していませんが、とりあえずは動いている感じです。設定も以下のように単純です。手動でのキャッシュ削除は設定画面の２箇所から可能です。</p>



<figure class="wp-block-image"><img src="/wp-content/uploads/2020/09/e382b7e383b3e38395e3829ae383abe382ade383a3e38383e382b7e383a5e280b9junkhack_e28094_wordpress.png" alt="シンプルキャッシュ‹JunkHack_—_WordPress" class="wp-image-5919"></figure>



<p>nginx_1.19.2 と、php-fpm_7.4.9 の組み合わせでも確認してみたいですね。</p>



<blockquote class="wp-block-quote"><p>Termuxパッケージ安定板<br>https://grimler.se/termux-packages-24/arm/</p></blockquote>



<p>nginxの1.19.2 は<a href="https://nginx.org/en/CHANGES" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">オフィシャル側<span class="wpel-icon wpel-image wpel-icon-1"></span></a>は 2020/08/11 に公開していて、termux 側は、8/18 なんでちゃんとメンテナンスされているようです。</p>



<p>とりあえず、apacheのhttpd.confのパッチは以下です。apache 2.4.46 のデフォルト設定ファイルとの差分です。</p>



<pre class="wp-block-code"><code>--- httpd.conf.org	2020-08-09 07:55:34.000000000 +0900
+++ httpd.conf	2020-09-06 01:56:57.560924026 +0900
@@ -63,8 +63,8 @@
 # Example:
 # LoadModule foo_module modules/mod_foo.so
 #
-#LoadModule mpm_prefork_module libexec/apache2/mod_mpm_prefork.so
-LoadModule mpm_worker_module libexec/apache2/mod_mpm_worker.so
+LoadModule mpm_prefork_module libexec/apache2/mod_mpm_prefork.so
+#LoadModule mpm_worker_module libexec/apache2/mod_mpm_worker.so
 LoadModule authn_file_module libexec/apache2/mod_authn_file.so
 #LoadModule authn_dbm_module libexec/apache2/mod_authn_dbm.so
 #LoadModule authn_anon_module libexec/apache2/mod_authn_anon.so
@@ -88,7 +88,7 @@
 #LoadModule cache_module libexec/apache2/mod_cache.so
 #LoadModule cache_disk_module libexec/apache2/mod_cache_disk.so
 #LoadModule cache_socache_module libexec/apache2/mod_cache_socache.so
-#LoadModule socache_shmcb_module libexec/apache2/mod_socache_shmcb.so
+LoadModule socache_shmcb_module libexec/apache2/mod_socache_shmcb.so
 #LoadModule socache_dbm_module libexec/apache2/mod_socache_dbm.so
 #LoadModule socache_memcache_module libexec/apache2/mod_socache_memcache.so
 #LoadModule socache_redis_module libexec/apache2/mod_socache_redis.so
@@ -109,7 +109,7 @@
 #LoadModule substitute_module libexec/apache2/mod_substitute.so
 #LoadModule sed_module libexec/apache2/mod_sed.so
 #LoadModule charset_lite_module libexec/apache2/mod_charset_lite.so
-#LoadModule deflate_module libexec/apache2/mod_deflate.so
+LoadModule deflate_module libexec/apache2/mod_deflate.so
 LoadModule mime_module libexec/apache2/mod_mime.so
 LoadModule log_config_module libexec/apache2/mod_log_config.so
 #LoadModule log_debug_module libexec/apache2/mod_log_debug.so
@@ -144,7 +144,7 @@
 #LoadModule session_dbd_module libexec/apache2/mod_session_dbd.so
 LoadModule slotmem_shm_module libexec/apache2/mod_slotmem_shm.so
 #LoadModule slotmem_plain_module libexec/apache2/mod_slotmem_plain.so
-#LoadModule ssl_module libexec/apache2/mod_ssl.so
+LoadModule ssl_module libexec/apache2/mod_ssl.so
 #LoadModule dialup_module libexec/apache2/mod_dialup.so
 #LoadModule http2_module libexec/apache2/mod_http2.so
 #LoadModule lbmethod_byrequests_module libexec/apache2/mod_lbmethod_byrequests.so
@@ -168,7 +168,7 @@
 &lt;/IfModule>
 #LoadModule dav_fs_module libexec/apache2/mod_dav_fs.so
 #LoadModule dav_lock_module libexec/apache2/mod_dav_lock.so
-#LoadModule vhost_alias_module libexec/apache2/mod_vhost_alias.so
+LoadModule vhost_alias_module libexec/apache2/mod_vhost_alias.so
 LoadModule negotiation_module libexec/apache2/mod_negotiation.so
 LoadModule dir_module libexec/apache2/mod_dir.so
 #LoadModule imagemap_module libexec/apache2/mod_imagemap.so
@@ -176,7 +176,7 @@
 #LoadModule speling_module libexec/apache2/mod_speling.so
 LoadModule userdir_module libexec/apache2/mod_userdir.so
 LoadModule alias_module libexec/apache2/mod_alias.so
-#LoadModule rewrite_module libexec/apache2/mod_rewrite.so
+LoadModule rewrite_module libexec/apache2/mod_rewrite.so
 
 &lt;IfModule unixd_module>
 #
@@ -242,8 +242,10 @@
 # documents. By default, all requests are taken from this directory, but
 # symbolic links and aliases may be used to point to other locations.
 #
-DocumentRoot "/data/data/com.termux/files/usr/share/apache2/default-site/htdocs"
-&lt;Directory "/data/data/com.termux/files/usr/share/apache2/default-site/htdocs">
+#DocumentRoot "/data/data/com.termux/files/usr/share/apache2/default-site/htdocs"
+DocumentRoot "/data/data/com.termux/files/home/htdocs"
+#&lt;Directory "/data/data/com.termux/files/usr/share/apache2/default-site/htdocs">
+&lt;Directory "/data/data/com.termux/files/home/htdocs">
     #
     # Possible values for the Options directive are "None", "All",
     # or any combination of:
@@ -256,14 +258,14 @@
     # http://httpd.apache.org/docs/2.4/mod/core.html#options
     # for more information.
     #
-    Options Indexes FollowSymLinks
+    Options FollowSymLinks
 
     #
     # AllowOverride controls what directives may be placed in .htaccess files.
     # It can be "All", "None", or any combination of the keywords:
     #   AllowOverride FileInfo AuthConfig Limit
     #
-    AllowOverride None
+    AllowOverride All
 
     #
     # Controls who can get stuff from this server.
@@ -276,7 +278,7 @@
 # is requested.
 #
 &lt;IfModule dir_module>
-    DirectoryIndex index.html
+    DirectoryIndex index.php index.html
 &lt;/IfModule>
 
 #
@@ -529,3 +531,22 @@
 SSLRandomSeed connect builtin
 &lt;/IfModule>
 
+LoadModule php7_module libexec/apache2/libphp7.so
+&lt;FilesMatch \.php
gt;
 +   SetHandler application/x-httpd-php
 +&lt;/FilesMatch>
 +&lt;IfModule dir_module>
 +    DirectoryIndex index.php
 +&lt;/IfModule>
 +
 +&lt;IfModule mod_deflate.c>
 +    DeflateCompressionLevel 1
 +    &lt;IfModule mod_filter.c>
 +        FilterDeclare COMPRESS
 +        FilterProvider COMPRESS DEFLATE "%{CONTENT_TYPE} =~ m#^text/#i"
 +        FilterProvider COMPRESS DEFLATE "%{CONTENT_TYPE} =~ m#^application/(atom\+xml|javascript|json|rss\+xml|xml|xhtml\+xml)#i"
 +        FilterProvider COMPRESS DEFLATE "%{CONTENT_TYPE} =~ m#^image/(svg\+xml|vnd\.microsoft\.icon)#i"
 +        FilterChain COMPRESS
 +        FilterProtocol COMPRESS DEFLATE change=yes;byteranges=no
 +    &lt;/IfModule>
 +&lt;/IfModule></code></pre>



<p>パッチの適用は上記をコピペしてp.txt などに保存、httpd.conf に以下のように patchしてください。</p>



<blockquote class="wp-block-quote"><p>$ patch -u httpd.conf &lt; p.txt</p></blockquote>



<p>成功すれば、patching file httpd.conf　のような表示となります。</p>



<p>mariadb のチューニングとかはやってないです。PHPは、php.ini&nbsp; に以下のように記載してあります。</p>



<blockquote class="wp-block-quote">
<p>$ cat /data/data/com.termux/files/usr/lib/php.ini<br>[PHP]</p>
<p>upload_max_filesize = 64M<br>post_max_size = 64M<br>memory_limit = 64M</p>
</blockquote>



<p>結構、スマホでも動くなー、いけそうだなーっていう感じです。</p>
					</div>
<!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div>
<!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-5823" class="post-5823 post type-post status-publish format-standard hentry category-blog category-linux">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="/5823.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2020-09-01T02:59:00+09:00">2020年9月1日</time></a> </span><span class="posted-on">更新日:2020年9月1日</span> <span class="categories">  <a href="/category/blog" rel="category tag noopener noreferrer" data-wpel-link="internal">Blog</a>, <a href="/category/linux" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a></span>			</div>
<!-- .entry-meta -->

							<h1 class="entry-title"><a href="/5823.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">Termuxのapache2+php+mariadbのチューニング前のwordpressの速度とか</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>さて、今回はメモ程度ですが スマホUMIDIGI F2に、termuxでapache2とphp7とmariadb10を入れた環境にWordPress代替えのClassicPressを入れて動作させてみました。いろいろ課題が見えて来たのでメモしておきます。まずは、どのくらいの速度で表示されるか、視覚的に見ると以下になります。約1.8秒です。</p>
<p><a href="https://www.webpagetest.org/video/view.php?id=200830_1626d4ffcc3e1d952ebf3b69ec30500fd1e9dd6a" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" class=" size-full wp-image-5848 aligncenter" src="/wp-content/uploads/2020/08/webpagetest_-_visual_comparison_-_aug_31__2020___jh_gpl_jp_-1.png" alt="WebPageTest_-_Visual_Comparison_-_Aug_31__2020___jh_gpl_jp_" width="405" height="329"></a></p>
<p>&nbsp;</p>
<p>これは、後ほど出て来ますが　https://www.webpagetest.org/　でのテスト結果です。ちょっと遅いですよね。まぁ、しかしスマホで動作していると思えば十分に速いかもしれません。</p>
<p>まだ設定は未調整ですがhttp接続（SSLじゃない80接続）でのベンチマークです。コマンドラインでのapache ab　テストもやってみました。同時に100ユーザが、1ユーザーあたり10リクエストを発行した場合を想定しています。これは、一般的なhtmlアクセスに対するjsやcssや画像のアクセスかなと思います。まぁ、このブログはそんな人気じゃないので同時に10人くらいのアクセスで十分かもですがw</p>
<p>サーバ側の状態は、ClassicPressをデフォルトで入れた状態です。テーマは、ClassicPressのTwentySixteenです。画像は出ない状態で全部テキストです。htmlやcssやjsやfontなど全部で、278 KBです。</p>
<p>まず、ローカルのリモート（macos）から。</p>
<blockquote>
<p class="p1"><span class="s1">$ ab -n 1000 -c 100 http://192.168.1.38:8080/</span></p>
</blockquote>
<pre>Server Software:        Apache/2.4.46
Server Hostname:        192.168.1.38
Server Port:            8080

Document Path:          /
Document Length:        15825 bytes

Concurrency Level:      100
Time taken for tests:   <strong><span style="color:#ff0000;">78.390</span></strong> seconds
Complete requests:      1000
Failed requests:        <strong><span style="color:#ff0000;">0</span></strong>
Total transferred:      16123000 bytes
HTML transferred:       15825000 bytes
Requests per second:    <strong><span style="color:#ff0000;">12.76</span></strong> [#/sec] (mean)
Time per request:       7839.037 [ms] (mean)
Time per request:       78.390 [ms] (mean, across all concurrent requests)
Transfer rate:          200.86 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        1    4  15.5      1     410
Processing:   490 7663 5599.2   6405   30174
Waiting:      461 7317 5486.8   5962   30109
Total:        494 7667 5599.1   6407   30175

Percentage of the requests served within a certain time (ms)
  50%   6407
  66%   7733
  75%   9622
  80%  10952
  90%  16804
  95%  19520
  98%  24822
  99%  26571
 100%  30175 (longest request)</pre>
<p>次は、GCPの東京リージョンからです。この経路は80←→8080にポート転送していますが、その差は感じない程度ですね。termux は、80ポートや443ポートでは運用できない制限がありますので、ルータで変換します。</p>
<blockquote>
<p class="p1"><span class="s1">$ ab -n 1000 -c 100 http://jh.gpl.jp/</span></p>
</blockquote>
<pre>Server Software: Apache/2.4.46
Server Hostname: jh.gpl.jp
Server Port: 80

Document Path: /
Document Length: 15742 bytes

Concurrency Level: 100
Time taken for tests: <strong><span style="color:#ff0000;">78.813</span></strong> seconds
Complete requests: 1000
Failed requests: <strong><span style="color:#ff0000;">0</span></strong>
Total transferred: 16040000 bytes
HTML transferred: 15742000 bytes
Requests per second: <span style="color:#ff0000;"><strong>12.69</strong></span> [#/sec] (mean)
Time per request: 7881.291 [ms] (mean)
Time per request: 78.813 [ms] (mean, across all concurrent requests)
Transfer rate: 198.75 [Kbytes/sec] received

Connection Times (ms)
min mean[+/-sd] median max
Connect: 21 190 525.8 51 3058
Processing: 707 7470 4143.1 7264 22358
Waiting: 605 7100 4070.2 6790 22218
Total: 804 7661 4221.0 7341 22409

Percentage of the requests served within a certain time (ms)
50% 7341
66% 8008
75% 8490
80% 9059
90% 14244
95% 16246
98% 20310
99% 21250
100% 22409 (longest request)</pre>
<p>次はtermuxが動作しているローカルからです。</p>
<blockquote>
<p class="p1"><span class="s1">$ ab -n 1000 -c 100 http://192.168.1.38:8080/</span></p>
</blockquote>
<pre>Server Software: Apache/2.4.46
Server Hostname: 192.168.1.38
Server Port: 8080

Document Path: /
Document Length: 15825 bytes

Concurrency Level: 100
Time taken for tests: <strong><span style="color:#ff0000;">77.274</span></strong> seconds
Complete requests: 1000
Failed requests: <strong><span style="color:#ff0000;">0</span></strong>
Total transferred: 16123000 bytes
HTML transferred: 15825000 bytes
Requests per second: <strong><span style="color:#ff0000;">12.94</span></strong> [#/sec] (mean)
Time per request: 7727.448 [ms] (mean)
Time per request: 77.274 [ms] (mean, across all concurrent requests)
Transfer rate: 203.76 [Kbytes/sec] received

Connection Times (ms)
min mean[+/-sd] median max
Connect: 1 1428 791.4 1531 3535
Processing: 562 6046 2311.5 5785 16840
Waiting: 515 4357 2249.9 3816 16085
Total: 649 7474 2189.4 7356 17166

Percentage of the requests served within a certain time (ms)
50% 7356
66% 8082
75% 8376
80% 8620
90% 9861
95% 11707
98% 12754
99% 13209
100% 17166 (longest request)</pre>
<p>ちなみに、ローカルのリモート（macos）からしか試していませんが、スマホの接続をWiFi接続を5Ghzではなく、2.4Ghzで接続した場合は以下でした。これ有線だとどうなるんでしょうかね。type-c と有線イーサネットは１つありますが、繋げても接続できなかったのでまだテストしていません。</p>
<pre>Server Software: Apache/2.4.46
Server Hostname: 192.168.1.38
Server Port: 8080

Document Path: /
Document Length: 15825 bytes

Concurrency Level: 100
Time taken for tests: <span style="color:#ff0000;"><strong>84.280</strong></span> seconds
Complete requests: 1000
Failed requests: <strong><span style="color:#ff0000;">0</span></strong>
Total transferred: 16123000 bytes
HTML transferred: 15825000 bytes
Requests per second: <strong><span style="color:#ff0000;">11.87</span></strong> [#/sec] (mean)
Time per request: 8427.984 [ms] (mean)
Time per request: 84.280 [ms] (mean, across all concurrent requests)
Transfer rate: 186.82 [Kbytes/sec] received

Connection Times (ms)
min mean[+/-sd] median max
Connect: 1 11 13.3 5 135
Processing: 491 7692 4699.6 7107 25513
Waiting: 443 7301 4611.2 6657 25511
Total: 493 7703 4700.0 7139 25514

Percentage of the requests served within a certain time (ms)
50% 7139
66% 8172
75% 9108
80% 10369
90% 14578
95% 18137
98% 20897
99% 22101
100% 25514 (longest request)</pre>
<p>多少、劣るようですがそこまで気にしなくてもいいかもです。</p>
<p>それよりも、最初のhtmlのロードが長いです。以下は一番最初のビデオの状態を詳細にみた結果です。まだ圧縮転送やキャッシュは効かせていませんが、マシン性能が出る部分ですかね。ちょっと遅いです。NGINXだともう少し速くなるかもですので、また試してみたいと思います。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5832" src="/wp-content/uploads/2020/08/e8b2bce3828ae4bb98e38191e3819fe794bbe5838f_2020_08_31_1_41.png" alt="貼り付けた画像_2020_08_31_1_41" width="977" height="1047"></p>
<p>このWEBページのindex相当になるファイルはサイズ、15kb程度です。例えば、phpinfoのページを読んだ結果は以下です。このページは、82.0 KBありますが、0.4秒で終わっています。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5833" src="/wp-content/uploads/2020/08/webpagetest_test_details_-_tokyo___jh_gpl_jp_info_php_-_08_31_20_01_45_34.png" alt="WebPageTest_Test_Details_-_Tokyo___jh_gpl_jp_info_php_-_08_31_20_01_45_34" width="970" height="831"></p>
<p>つまり、mariadbにアクセスしたりphpでのwordpressの処理時間がかかっているから遅くなっているということになりますね。</p>
<p>例えば、これは以前検討していたマシンでの結果ですが、htmlのロードは0.2秒以内に終わっています。UnixBenchが7000近く出るマシンでネットワークもIPv4→IPv6トンネルなので、比較するとあれですが、どこまで近づけるかですね。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5835" src="/wp-content/uploads/2020/08/webpagetest_test_details_-_tokyo___hoge_gpl_jp_-_03_16_20_02_24_59.png" alt="WebPageTest_Test_Details_-_Tokyo___hoge_gpl_jp_-_03_16_20_02_24_59" width="950" height="925"></p>
<p>まぁ、速度的なことより困っていることがあります。それは、ローカルのマシンから、termux上で動作しているwordpressにグローバルIPでアクセスできないことです。この場合、ルータの管理画面にアクセスしちゃうんで、どうしようかなと。こういうのなんていうんでしたっけか？　とにかく、今の拠点のルータ（PR-400KI）は、内側ネットワークから外側のグローバルアドレスにアクセスしたものを、変換（最終的にサーバのプライベートアドレスに変換）してくれないのです。</p>
<p>プライベートアドレスだと、wordpressの設定で、グローバルのIPがマッピングされているドメイン名の設定になっているので（ルータで80と8080をポート転送してwordpressを運用）、リダイレクトされてアクセスできないんですよね。これはwordpress の仕様みたいなので回避不可能かなと。なんか言葉で書くとわかりにくいですね。今度、時間があるときに図解で問題点を明確にしたいです。</p>
<p>今の所、２案あります。１つは、マルチセッションを貼って違う光プロバイダーからアクセスさせる方法。もう一つは、リバースプロキシを経由させる方法です。</p>
<p>スマホで非ルートで動かすtermux は、IPテーブルとかルーティングとかいじれないので工夫が必要ですね。</p>
<p>ネットワークはあんまり得意じゃないんで、もっといい解決方法があるかもしれませんが。</p>
					</div>
<!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div>
<!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-5786" class="post-5786 post type-post status-publish format-standard hentry category-blog category-linux">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="/5786.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2020-08-29T01:01:07+09:00">2020年8月29日</time></a> </span><span class="posted-on">更新日:2020年8月29日</span> <span class="categories">  <a href="/category/blog" rel="category tag noopener noreferrer" data-wpel-link="internal">Blog</a>, <a href="/category/linux" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a></span>			</div>
<!-- .entry-meta -->

							<h1 class="entry-title"><a href="/5786.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">衝撃価格7500円でゲットしたRedmi Note 9SにLinux入れてUnixBenchを計測</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>いやー、もう８月も終わりに近づてきましたね〜！<br>
皆さんはどっか行きましたか？　自分はお盆休みもバイクをモリワキカラーに塗っていましたよ。どこにも行ってないので、そろそろプチ旅行したいです。バイクに乗りたいですね。</p>
<p>さて、今回はOCNモバイルONEの乗り換えキャンペーンで激安7500円で新品本体をゲットしましたRedmi Note 9S にUnixBechを走らせてみたいと思います。<br>
AndroidスマホなのにLinux上で走るUnixBenchをどうやって動かすってことですが、これは、TermuxというAndroidターミナルエミュレーター＋Linux環境構築アプリがあります。この環境で、UnixBenchをビルドしてスコアを計測してみました。antutuは２８万くらいらしいのですが、UnixBenchはどのくらい出るでしょうか。ちなみに、UmidigiF2は、<a href="/2020/08/24/android%e3%82%b9%e3%83%9e%e3%83%9b%e3%81%abcentos%e3%81%a8%e3%81%8bubuntu%e3%81%a8%e3%81%8b%e5%85%a5%e3%82%8c%e3%81%a6%e6%b4%bb%e7%94%a8%e3%81%a7%e3%81%8d%e3%82%8b%e3%81%8b%e6%a4%9c%e8%a8%8e%e3%81%97/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">前回</a></p>
<blockquote><p>シングルCPU・・・スコア406.2<br>
8CPU・・・・・・スコア1312.3</p></blockquote>
<p>のスコアが出ました。<br>
まだシステムのアップデートする前なんで、少しkernelバージョンは変わるかもしれませんが、計測時のスマホの状態を貼っておきます。Redmi Note 9Sは、CPUがUmidigiF2よりも速いので、1500くらいのスコアが出るかもなーと思っていますが、さてどのくらいになるでしょうか？</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5791" src="/wp-content/uploads/2020/08/e8b2bce3828ae4bb98e38191e3819fe794bbe5838f_2020_08_28_22_39.png" alt="貼り付けた画像_2020_08_28_22_39" width="864" height="1920"></p>
<p>まぁ、前置きが長かったのですが、やってることは大したことはないです。まずはGoogleStoreから、以下のアプリを入れておきます。これなんて読むんですかね？　たーむゆーえっくす　とか、たーむっくす　とかかな？</p>
<p><a href="https://play.google.com/store/apps/details?id=com.termux&amp;hl=ja" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" class="alignnone size-full wp-image-5793" src="/wp-content/uploads/2020/08/termux_-_google_play_e381aee382a2e38395e3829ae383aa.png" alt="Termux_-_Google_Play_のアプリ" width="690" height="558"></a></p>
<p>openssh を入れてリモートから作業します。スマホ画面では、最低限以下を入れて起動しておきます。</p>
<blockquote><p>pkg install openssh -y &amp;&amp; sshd</p></blockquote>
<p>WiFi アドレスを確認しておきます。</p>
<blockquote><p>ip a | more<br>
または、<br>
<span class="s1">ip a | grep inet | grep wlan<br>
もっとズバリIPだけ取り出したい場合は、<br>
</span><span class="s1">ip -4 a | grep inet | grep wlan0 | grep -oP &#8216;[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+(?=\/)&#8217;</span></p></blockquote>
<p>鍵作るなり、パスワード設定するなりしてリモートからログインします。今回は、passwd　してパスワード認証でリモートログイン。</p>
<blockquote>
<p class="p1"><span class="s1">ssh 192.168.xxx.xxx -p 8022</span></p>
</blockquote>
<p>デフォルトsshポートは、8022　です。では、UnixBenchのビルドに必要なツールを入れましょう。</p>
<blockquote>
<p class="p1"><span class="s1">pkg install vim wget clang make perl git pkg-config -y</span></p>
</blockquote>
<p>あとは前回と同様、Makefileを少し修正して　./Run　です。</p>
<blockquote><p>git clone <a href="https://github.com/kdlucas/byte-unixbench" rel="nofollow external noopener noreferrer" data-wpel-link="external" target="_blank" class="wpel-icon-right">https://github.com/kdlucas/byte-unixbench<span class="wpel-icon wpel-image wpel-icon-1"></span></a><br>
cd byte-unixbench/UnixBench<br>
cp -p Makefile Makefile.org<br>
vi Makefile<br>
※以下部分を削除してね。（-march=native）</p></blockquote>
<blockquote>
<pre>$ diff -u Makefile.org Makefile
--- Makefile.org	2020-08-28 23:39:45.550203419 +0900
+++ Makefile	2020-08-28 23:40:56.800203392 +0900
@@ -95,7 +95,7 @@
     #   - Supported    : x86, x86_64, ARM, AARCH64, etc..
     #   - Not Supported: RISC-V, IBM Power, etc...
     ifneq ($(ARCH),$(filter $(ARCH),ppc64 ppc64le))
-        OPTON += -march=native -mtune=native
+        OPTON += -mtune=native
     else
         OPTON += -mcpu=native -mtune=native
     endif</pre>
</blockquote>
<blockquote><p>./Run<br>
::</p></blockquote>
<p>金曜の夜は眠いです、、、寝そうになりましたがベンチマークが終わったので貼り付け。</p>
<p>CPU:Qualcomm Snapdragon 720G<br>
Hardware : Qualcomm Technologies, Inc SM7125</p>
<blockquote>
<pre>========================================================================
   BYTE UNIX Benchmarks (Version 5.1.3)

   System: localhost: Android
   OS: Android -- 4.14.117-perf-g2d34faf -- #1 SMP PREEMPT Wed May 13 01:02:15 CST 2020
   Machine: aarch64 (unknown)
   Language: en_US.utf8 (charmap=, collate=)
   23:41:17 up 12:11,  load average: 0.00, 0.00, 0.00; runlevel 

------------------------------------------------------------------------
Benchmark Run: Fri Aug 28 2020 23:41:17 - 00:09:22
8 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables       32061907.1 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     6143.9 MWIPS (10.0 s, 7 samples)
Execl Throughput                                267.0 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        630326.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          205587.3 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1214283.1 KBps  (30.0 s, 2 samples)
Pipe Throughput                             1227952.4 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 105358.2 lps   (10.0 s, 7 samples)
Process Creation                                594.4 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   1306.7 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                    311.0 lpm   (60.1 s, 2 samples)
System Call Overhead                        1131049.8 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   32061907.1   2747.4
Double-Precision Whetstone                       55.0       6143.9   1117.1
Execl Throughput                                 43.0        267.0     62.1
File Copy 1024 bufsize 2000 maxblocks          3960.0     630326.5   1591.7
File Copy 256 bufsize 500 maxblocks            1655.0     205587.3   1242.2
File Copy 4096 bufsize 8000 maxblocks          5800.0    1214283.1   2093.6
Pipe Throughput                               12440.0    1227952.4    987.1
Pipe-based Context Switching                   4000.0     105358.2    263.4
Process Creation                                126.0        594.4     47.2
Shell Scripts (1 concurrent)                     42.4       1306.7    308.2
Shell Scripts (8 concurrent)                      6.0        311.0    518.3
System Call Overhead                          15000.0    1131049.8    754.0
                                                                   ========
System Benchmarks Index Score                                         569.6

------------------------------------------------------------------------
Benchmark Run: Sat Aug 29 2020 00:09:22 - 00:37:59
8 CPUs in system; running 8 parallel copies of tests

Dhrystone 2 using register variables      120620219.0 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                    26336.2 MWIPS (9.5 s, 7 samples)
Execl Throughput                               1110.7 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        588338.4 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          181982.1 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1457866.0 KBps  (30.0 s, 2 samples)
Pipe Throughput                             4512922.8 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 160612.9 lps   (10.0 s, 7 samples)
Process Creation                                947.0 lps   (30.1 s, 2 samples)
Shell Scripts (1 concurrent)                   2990.6 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    399.8 lpm   (60.5 s, 2 samples)
System Call Overhead                        3946715.9 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0  120620219.0  10335.9
Double-Precision Whetstone                       55.0      26336.2   4788.4
Execl Throughput                                 43.0       1110.7    258.3
File Copy 1024 bufsize 2000 maxblocks          3960.0     588338.4   1485.7
File Copy 256 bufsize 500 maxblocks            1655.0     181982.1   1099.6
File Copy 4096 bufsize 8000 maxblocks          5800.0    1457866.0   2513.6
Pipe Throughput                               12440.0    4512922.8   3627.8
Pipe-based Context Switching                   4000.0     160612.9    401.5
Process Creation                                126.0        947.0     75.2
Shell Scripts (1 concurrent)                     42.4       2990.6    705.3
Shell Scripts (8 concurrent)                      6.0        399.8    666.3
System Call Overhead                          15000.0    3946715.9   2631.1
                                                                   ========
System Benchmarks Index Score                                        1177.5</pre>
</blockquote>
<p>シングル性能では、UmidigiF2より上ですが、マルチCPUは下ですね。</p>
<blockquote><p>シングルCPU・・・スコア569.6<br>
8CPU・・・・・・スコア1177.5</p></blockquote>
<p>特に、プロセスのフォーク処理（Process Creation）とか、シェル関連とか、パイプ処理（Pipe-based Context Switching）が半分くらい遅いですね。なんでこんなに遅いのでしょうか？　システムバージョンアップして、また計測してみます。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5800" src="/wp-content/uploads/2020/08/e8b2bce3828ae4bb98e38191e3819fe794bbe5838f_2020_08_29_0_57.png" alt="貼り付けた画像_2020_08_29_0_57" width="864" height="1920"></p>
<p>再起動後の情報です。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5804" src="/wp-content/uploads/2020/08/e8b2bce3828ae4bb98e38191e3819fe794bbe5838f_2020_08_29_1_06.png" alt="貼り付けた画像_2020_08_29_1_06" width="864" height="1920"></p>
<p>Kernelの末尾の番号だけ微妙に変わっていますが、メジャー・マイナー・メンテナンスの番号は変わらずですね。4.14.117です。UmidigiF2は、4.14.141+で新しいですね。</p>
<p>結果が出たら貼り付けておきます。今日はもうねるー！　UmidigiF2　のCPU、MediaTek Helio P70もなかなか良いのかもね。</p>
<p>追記。翌日ベンチマークが終わっていたので貼り付けておきます。誤差の範囲でほぼ同じ結果でした。今回もやはり、プロセスのフォーク処理（Process Creation）とか、シェル関連とか、パイプ処理（Pipe-based Context Switching）がUmidigiF2と比べて半分くらい遅い結果となりました。何かKernelかOS設定で制限があるのかもですね。ファイルコピーなんかは倍くらいRedmeNote9sが速いですが。</p>
<p>CPUやストレージが速ければ全部のスコアが上がるというわけはないということですね。</p>
<blockquote><p>シングルCPU・・・スコア571.9<br>
8CPU・・・・・・スコア1127.1</p></blockquote>
<p>ちなみに、UnixBenchのパイプ処理に使うバイナリのヘッダ情報も乗せておきます。ちゃんと64bitでビルドされていますね。Termux、なかなかいいんじゃないでしょうか。</p>
<blockquote><p>$ readelf -h ./spawn<br>
ELF Header:<br>
Magic: 7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00<br>
Class: ELF64<br>
Data: 2&#8217;s complement, little endian<br>
Version: 1 (current)<br>
OS/ABI: UNIX &#8211; System V<br>
ABI Version: 0<br>
Type: DYN (Shared object file)<br>
Machine: AArch64<br>
Version: 0x1<br>
Entry point address: 0x760<br>
Start of program headers: 64 (bytes into file)<br>
Start of section headers: 7184 (bytes into file)<br>
Flags: 0x0<br>
Size of this header: 64 (bytes)<br>
Size of program headers: 56 (bytes)<br>
Number of program headers: 8<br>
Size of section headers: 64 (bytes)<br>
Number of section headers: 24<br>
Section header string table index: 23</p></blockquote>
<p>ということで、次回はUmidigiF2にWordPressが動く環境を作ってテストしてみたいですね。</p>
<pre>   BYTE UNIX Benchmarks (Version 5.1.3)

   System: localhost: Android
   OS: Android -- 4.14.117-perf-g638d6a0 -- #1 SMP PREEMPT Fri Jun 19 01:24:32 CST 2020
   Machine: aarch64 (unknown)
   Language: en_US.utf8 (charmap=, collate=)
   01:18:25 up 17 min,  load average: 0.55, 1.10, 1.44; runlevel 

------------------------------------------------------------------------
Benchmark Run: Sat Aug 29 2020 01:18:25 - 01:46:30
8 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables       32007008.4 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     6140.3 MWIPS (10.0 s, 7 samples)
Execl Throughput                                261.7 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        628988.7 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          207751.6 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1478525.0 KBps  (30.0 s, 2 samples)
Pipe Throughput                             1164727.3 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                  99925.0 lps   (10.0 s, 7 samples)
Process Creation                                587.5 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   1284.4 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                    312.1 lpm   (60.2 s, 2 samples)
System Call Overhead                        1127699.3 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   32007008.4   2742.7
Double-Precision Whetstone                       55.0       6140.3   1116.4
Execl Throughput                                 43.0        261.7     60.9
File Copy 1024 bufsize 2000 maxblocks          3960.0     628988.7   1588.4
File Copy 256 bufsize 500 maxblocks            1655.0     207751.6   1255.3
File Copy 4096 bufsize 8000 maxblocks          5800.0    1478525.0   2549.2
Pipe Throughput                               12440.0    1164727.3    936.3
Pipe-based Context Switching                   4000.0      99925.0    249.8
Process Creation                                126.0        587.5     46.6
Shell Scripts (1 concurrent)                     42.4       1284.4    302.9
Shell Scripts (8 concurrent)                      6.0        312.1    520.1
System Call Overhead                          15000.0    1127699.3    751.8
                                                                   ========
System Benchmarks Index Score                                         571.9

------------------------------------------------------------------------
Benchmark Run: Sat Aug 29 2020 01:46:30 - 02:15:04
8 CPUs in system; running 8 parallel copies of tests

Dhrystone 2 using register variables      122466899.1 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                    26082.3 MWIPS (9.9 s, 7 samples)
Execl Throughput                               1100.0 lps   (29.7 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        509969.0 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          147009.9 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1308075.6 KBps  (30.0 s, 2 samples)
Pipe Throughput                             4401030.7 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 163599.9 lps   (10.0 s, 7 samples)
Process Creation                               1059.8 lps   (30.1 s, 2 samples)
Shell Scripts (1 concurrent)                   2761.2 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    366.4 lpm   (60.8 s, 2 samples)
System Call Overhead                        3964160.3 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0  122466899.1  10494.2
Double-Precision Whetstone                       55.0      26082.3   4742.2
Execl Throughput                                 43.0       1100.0    255.8
File Copy 1024 bufsize 2000 maxblocks          3960.0     509969.0   1287.8
File Copy 256 bufsize 500 maxblocks            1655.0     147009.9    888.3
File Copy 4096 bufsize 8000 maxblocks          5800.0    1308075.6   2255.3
Pipe Throughput                               12440.0    4401030.7   3537.8
Pipe-based Context Switching                   4000.0     163599.9    409.0
Process Creation                                126.0       1059.8     84.1
Shell Scripts (1 concurrent)                     42.4       2761.2    651.2
Shell Scripts (8 concurrent)                      6.0        366.4    610.7
System Call Overhead                          15000.0    3964160.3   2642.8
                                                                   ========
System Benchmarks Index Score                                        1127.1</pre>
					</div>
<!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div>
<!-- .entry-wrapper -->
</article><!-- #post-## -->

			
				
<article id="post-5769" class="post-5769 post type-post status-publish format-standard hentry category-android category-ios category-linux category-osx">
	<div class="entry-wrapper">



		<header class="entry-header">
					<span class="entry-format theme-genericon"></span>
	
			<div class="entry-meta">
				<span class="posted-on">投稿日: <a href="/5769.html" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2020-08-24T12:25:53+09:00">2020年8月24日</time></a> </span><span class="posted-on">更新日:2020年8月24日</span> <span class="categories">  <a href="/category/android" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/ios" rel="category tag noopener noreferrer" data-wpel-link="internal">ios</a>, <a href="/category/linux" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/osx" rel="category tag noopener noreferrer" data-wpel-link="internal">osx</a></span>			</div>
<!-- .entry-meta -->

							<h1 class="entry-title"><a href="/5769.html" rel="bookmark noopener noreferrer" data-wpel-link="internal">神アプリ。PCからiosやandroidスマホ画面を触れる開発者必須のツール</a></h1>					</header><!-- .entry-header -->

		<div class="entry-content">
			<p>アプリ開発って、複数端末を操らないといけないので結構面倒なんですよね。できれば、PC画面のキーボード、マウスから手を離したくはないのです。いちいち、スマホに目線を移動して画面を見て触らないといけないのが面倒です。</p>
<p>さて、そんな開発者のあなた！　今日のネタは必見ですよ〜。別に開発者じゃなくても便利に使えますのでちょっと紹介しますね。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5772" src="/wp-content/uploads/2020/08/wormhole_takehikoe381aeiphone__e381a8_wormhole_e381a8_e696b0e38197e38184e382bfe38395e38299.png" alt="Wormhole_TakehikoのiPhone__と_Wormhole_と_新しいタブ" width="1025" height="864"></p>
<p>はい、この画面macosでスマホを操っている画面です。左側は、iosで、右側がandroidです。PCのマウスやキーボードでスマホを触れてめちゃくちゃ便利ですよ。これを実現するのは以下のアプリです。WormHoleです！</p>
<p><a href="https://er.run/" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" class="alignnone size-full wp-image-5774" src="/wp-content/uploads/2020/08/wormhole_-_control_phone_from_pc.png" alt="Wormhole_-_Control_phone_from_PC" width="1015" height="280"></a></p>
<p>androidは無料で、android側に入れるアプリは以下です。</p>
<p><a href="https://play.google.com/store/apps/details?id=com.viper.wormhole" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" class="alignnone size-full wp-image-5775" src="/wp-content/uploads/2020/08/wormhole_-_bridge_between_mobile___desktop_-_google_play_e381aee382a2e38395e3829ae383aa.png" alt="Wormhole_-_Bridge_between_Mobile___Desktop_-_Google_Play_のアプリ" width="691" height="589"></a></p>
<p>Androidは、スマホ側にこのアプリを入れますが、iosは何も必要ありません。スマホとUSBケーブルで接続し、WormholeのPCアプリを起動すると以下のように画面が出ます。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5777" src="/wp-content/uploads/2020/08/e382b9e382afe383aae383bce383b3e382b7e383a7e38383e38388_2020_08_24_11_44.png" alt="スクリーンショット_2020_08_24_11_44" width="851" height="680"></p>
<p>画面のローテートにも対応していて、横画面にするとPC側も横長で表示されます。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5778" src="/wp-content/uploads/2020/08/wormhole.png" alt="Wormhole" width="864" height="462"></p>
<p>これはTermuxを横表示した画面です。PCキーボードでタイプできます。神ですよね。例えば、設定でダークモードをOn/Offしたければこんな感じでPC画面からスマホを操れます。</p>
<p><img loading="lazy" class=" size-full wp-image-5779 aligncenter" src="/wp-content/uploads/2020/08/wormhole-1.png" alt="Wormhole" width="462" height="864"></p>
<p>iosの場合は、1084円の有料ですがこの価値はあるかと思います。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5780" src="/wp-content/uploads/2020/08/wormhole_store.png" alt="Wormhole_Store" width="985" height="318"></p>
<p>例えば、awaアプリ（音楽ストリーミングアプリ）を起動するとPC経由からブルートース経由で音が鳴らせます。</p>
<p><img loading="lazy" class=" size-full wp-image-5781 aligncenter" src="/wp-content/uploads/2020/08/wormhole_takehikoe381aeiphone_.png" alt="Wormhole_TakehikoのiPhone_" width="557" height="862"></p>
<p>PC側のブルートースにはiPhoneがコネクトされています。iosはUSBとブルートース接続が必要のようです。USBの代わりにWiFi経由でも可能ですが、開発時にはxcodeからデバックするために、USBケーブル接続していますし、充電もできるので問題ありません。</p>
<p><img loading="lazy" class="alignnone size-full wp-image-5782" src="/wp-content/uploads/2020/08/bluetooth.png" alt="Bluetooth" width="668" height="432"></p>
<p>PC側に負荷をかけずに音楽を鳴らせるのでなかなかいい感じです。また、スクリーンショットなんかも簡単にクリップボード経由で撮れるので、スマホでスクショ撮るより全然便利です。スマホでスクショ撮るとその転送が面倒なんで。</p>
<p>非ルート化しなくても、iosもandroidもPC側から触れるツールは自分が知る限りこれしかありません。ということで、神アプリとなっています。</p>
<p>では、またー！</p>
<p>&nbsp;</p>
					</div>
<!-- .entry-content -->

			<footer class="entry-footer">
							
			</footer><!-- .entry-footer -->
		</div>
<!-- .entry-wrapper -->
</article><!-- #post-## -->

			
			
	<nav class="navigation posts-navigation" role="navigation" aria-label="投稿">
		<h2 class="screen-reader-text">投稿ナビゲーション</h2>
		<div class="nav-links">
<div class="nav-previous"><a href="/category/linux/page/7" data-wpel-link="internal" rel="noopener noreferrer">過去の投稿</a></div>
<div class="nav-next"><a href="/category/linux/page/5" data-wpel-link="internal" rel="noopener noreferrer">新しい投稿</a></div>
</div>
	</nav>
		
		</main><!-- #main -->
	</section><!-- #primary -->


	</div>
<!-- #content -->

	<footer id="colophon" class="site-footer wrap" role="contentinfo">
		<div class="site-info">
			Copyleft - all rights reversed.
			<span class="sep"> | </span>
			JunkHack 2011 - 2021
			<span class="sep"> | </span>
			<a href="https://junkhack.gpl.jp/about-junkhack/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">運営者情報<span class="gf"><span class="wpel-icon wpel-image wpel-icon-1"></span></span></a><span class="sep"> | </span>
			<a href="https://junkhack.gpl.jp/sendmail/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">お問い合わせ<span class="gf"><span class="wpel-icon wpel-image wpel-icon-1"></span></span></a><span class="sep"> | </span>
			<a href="https://junkhack.gpl.jp/privacy/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">プライバシーポリシー<span class="gf"><span class="wpel-icon wpel-image wpel-icon-1"></span></span></a>
		</div>
<!-- .site-info -->

	</footer><!-- #colophon -->
</div>
<!-- #page -->

        <div id="wpfront-scroll-top-container">
            <img src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt="">        </div>
                <script type="text/javascript">
            function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();
        </script>
        <script type="text/javascript" src="/wp-content/plugins/wpfront-scroll-top/js/wpfront-scroll-top.min.js?ver=2.0.4.04013" id="wpfront-scroll-top-js"></script>
<script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/hew.js?ver=20140909" id="hew-scripts-js"></script>
<script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/navigation.js?ver=20120206" id="hew-navigation-js"></script>
<script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/skip-link-focus-fix.js?ver=20130115" id="hew-skip-link-focus-fix-js"></script>
<script type="text/javascript" src="/wp-includes/js/wp-embed.min.js?ver=5.7.2" id="wp-embed-js"></script>

</body>
</html>